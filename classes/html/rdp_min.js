var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(p,C,J){p!=Array.prototype&&p!=Object.prototype&&(p[C]=J.value)};$jscomp.getGlobal=function(p){return"undefined"!=typeof window&&window===p?p:"undefined"!=typeof global&&null!=global?global:p};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(p,C,J,M){if(C){J=$jscomp.global;p=p.split(".");for(M=0;M<p.length-1;M++){var S=p[M];S in J||(J[S]={});J=J[S]}p=p[p.length-1];M=J[p];C=C(M);C!=M&&null!=C&&$jscomp.defineProperty(J,p,{configurable:!0,writable:!0,value:C})}};$jscomp.polyfill("Array.prototype.fill",function(p){return p?p:function(p,J,M){var C=this.length||0;0>J&&(J=Math.max(0,C+J));if(null==M||M>C)M=C;M=Number(M);0>M&&(M=Math.max(0,C+M));for(J=Number(J||0);J<M;J++)this[J]=p;return this}},"es6-impl","es3");
var svManager={getInstance:function(){var p=window.$rdp;return p&&p.running&&p.running()?p:null}};svGlobal.getInstance=svManager.getInstance;
function connvertServer(p){var C={};C.id=p.id;C.server=p.id;C.displayName=p.displayName||p.id;if(p=p.rdp){for(var J in p)C[J]=p[J];C.user=p.username||"";C.pwd=p.password||"";C.useConsole=p.console||!1;C.legacyMode=p.leagacyMode||p.legacyMode||!1;C.server_bpp=p.color||16;C.exe=p.remoteProgram||"";C.args=p.remoteArgs||"";C.startProgram=0<C.exe.length?"app":C.command&&0<C.command.length?"shell":"noapp"}return C}
function Rdp2(p){p=svGlobal.util.getServerArgs(p);if(!p||!p.gateway)return hi5.notifications.notify({msg:__svi18n.noauth}),null;var C=p.gateway||"",J=0,M=0,S=16,W=1==p.useSSL||"true"==p.useSSL||"on"==p.useSSL||null;p.width&&(J=parseInt(p.width,10));p.height&&(M=parseInt(p.height,10));p.color&&(S=parseInt(p.color,10));p.server_bpp&&(S=parseInt(p.server_bpp,10));p=hi5.browser.obj2url(p);null===W&&(W="https:"==location.protocol);return new Rdp((W?"wss://":"ws://")+C+"/RDP?"+p,J,M,S)}
svGlobal.Rdp2||(svGlobal.Rdp2=Rdp2);
function Rdp(p,C,J,M){var S,W;function X(a){return"on"==a||"true"==a||1==a}function qa(){var a=e.gateway;e.ongetgatewayaddress&&(a=e.ongetgatewayaddress(a));return a}function Bb(){var a=hi5.storage.get("SV_CONN_SHARE_ID");a||(a=hi5.tool.uuid(),hi5.storage.set("SV_CONN_SHARE_ID",a));return a}function ra(){return l.displayName||l.server||l.symlink||l.id||"undefined"}function Ea(a,b,c){e.ontitlechange&&(a=e.ontitlechange(a,c));e.setTitle&&a&&(b=b||window,b.document.title=a)}function $a(a,b){y?y.resize(a,
b):y=new ab(a,b);return y}function sa(a,b){switch(a){case 16:case 8:case 24:case 32:break;case 15:return l.invitation||e.showMessage("15 bit color is not supported anymore."),!1;default:return!1}na=a;b&&(K?K.postMessage({type:0,cmd:1,data:a}):D&&D.setColor(a));return!0}function bb(){U?(I=(l.waWidth||hi5.browser.getScreenWidth())|0,G=(l.waHeight||hi5.browser.getScreenHeight())|0):(I&=-4,G&=-4);l.minWidth&&I<l.minWidth&&(I=l.minWidth|0);l.minHeight&&G<l.minHeight&&(G=l.minHeight|0)}function la(a,b,
c,g){I=a;G=b;Fa=Ga=0;Ha=I-1;Ia=G-1;bb();svGlobal.logger.warn("resolution changed, w:"+a+" h:"+b);y=$a(I,G);w.setSize(I,G,U?"hidden":null);c&&(K?K.postMessage({type:0,cmd:2,data:{w:I,h:G}}):D&&D.setResolution(I,G));if(e.onresolutionchange&&!g)e.onresolutionchange(a,b)}function A(a){ca||(K?(Ja.data=a,"string"!=typeof a?K.postMessage(Ja,[a]):K.postMessage(Ja)):D.writeRawInput(a))}function cb(a){switch(a){case "\r":break;case "\n":e.writeScancode(28);break;case "\t":e.writeScancode(15);break;default:A("86"+
a)}}function Ka(a){if(e){var b=__svi18n.errorCode[a];b||(b="error "+a);if(e.onerror)e.onerror({name:a,message:b});e.displayMsg&&hi5.notifications.notify({msg:b});0<svGlobal.log&&console.error&&console.error(b)}}function La(a){if(e){var b=__svi18n.info[a];b||(b="info "+a);e.displayMsg&&hi5.notifications.notify({msg:b});svGlobal.logger.info(b)}}function Ma(){ma=L=!1;K?K.postMessage({type:0,cmd:3}):D&&D.resetStatus()}function Cb(){var a=w.getFocused(),a=a?a.getWindow():window;return"&waWidth="+l.waWidth+
"&waHeight="+l.waHeight+"&dpWidth="+a.innerWidth+"&dpHeight="+a.innerHeight}function Db(a){var b={},c=0,g=a;this.enabled=!0;hi5.EventControl(this);var d=this,f=null,k=0,x=!0,u=!0;this.setDownload=function(a){x=a};this.setUpload=function(a){u=a};this.release=function(){b=g=a=d=null};this.read=function(f,k,g){var h=b[b[f]];if("undefined"!=typeof h){var q=h.name;if(1>h.size&&__svi18n.file.zero)e.showMessage(__svi18n.file.zero+q,null,3E3);else{var q=h.slice(k,k+g),x=new FileReader;x.onloadend=function(b){b.target.readyState==
FileReader.DONE&&(b=new Uint8Array(b.target.result),a.send(f,k,g,b,h.preferPaste),c+=g,d.fireEvent("progress",[c]))};x.readAsArrayBuffer(q)}}};this.mkdirs=function(b){d.enabled&&("/"!=b.charAt(b.length-1)&&(b+="/"),a.start([b],0,!0))};this.addFiles=function(f,c){var g=f.length;if(g&&d.enabled&&u){var h=c&&!!(Z&65536);k=Date.now();for(var x=0;x<g;x++){var n=f[x];c&&(n.preferPaste=!0);var r=n.fullPath||n.name;if(e.beforeupload&&e.beforeupload(n,r,h))return;d.fireEvent("beforeupload",[n,r,h]);r=encodeURIComponent(r);
b[r]=n}a.start(f,c);d.fireEvent("uploadstarted",[h])}};this.removeFile=function(a){g.remove(a)};this.confirmId=function(a,d,f){b[a]=d;f&&(c+=parseInt(f))};this.close=function(a){var f=!0,g={size:c,duration:Date.now()-k};if(a){var h=b[a];if(h){f=b[h].preferPaste;delete b[a];delete b[h];a=decodeURIComponent(h);if(e.onfileuploaded)e.onfileuploaded(a,f,g);d.fireEvent("fileuploaded",[a,f&&!!(Z&65536),g])}for(var x in b)return}else b={};k=c=0;d.fireEvent("uploaded",[f&&!!(Z&65536),g]);if(e.onuploaded)e.onuploaded(f&&
!!(Z&65536),g)};this.cancelAll=function(){g.cancelAll();if(e.onuploadingCancelled)e.onuploadingCancelled();d.fireEvent("uploadingCancelled");d.close()};this.list=function(a,b){f=b;g.list(a)};this.notifyFiles=function(a){f&&f(a);d.fireEvent("files")};this.download=function(){x&&g.download()}}function Eb(){function a(a,c){var b=c.length,d=new Uint8Array(2+2*b);d[0]=58;d[1]=a;for(var f,k=2,e=0;e<b;e++)f=c.charCodeAt(e),d[k++]=f&255,d[k++]=f>>8&255;A(d.buffer)}this.start=function(a,c,g){for(var b=a.length,
f=20*b+2,k=0,e=new Uint8Array(8),u=2,n,r,E;k<b;k++)f=g?f+2*(encodeURIComponent(a[k]).length+1):f+2*(encodeURIComponent(a[k].fullPath||a[k].name).length+1);f=new Uint8Array(f);f[0]=58;f[1]=0;c&&(f[1]|=128);for(k=0;k<b;k++){c=g?0:a[k].size;f[u++]=c&255;f[u++]=c>>8&255;f[u++]=c>>16&255;f[u++]=c>>24&255;4294967296>c?u+=4:(c=hi5.NumUtils.splitInt64(c).high,f[u++]=c&255,f[u++]=c>>8&255,f[u++]=c>>16&255,f[u++]=c>>24&255);g||hi5.NumUtils.toBytes(a[k].lastModified||a[k].lastModifiedDate.getTime(),e);f.set(e,
u);u+=12;c=encodeURIComponent(g?a[k]:a[k].fullPath||a[k].name);n=c.length;for(r=0;r<n;r++)E=c.charCodeAt(r),f[u++]=E&255,f[u++]=E>>8&255;u+=2}A(f.buffer)};this.send=function(a,c,g,d,f){var b=new Uint8Array(22+g);b[0]=58;b[1]=3;f&&(b[1]|=128);f=2;b[f++]=a&255;b[f++]=a>>8&255;b[f++]=a>>16&255;b[f++]=a>>24&255;b[f++]=c&255;b[f++]=c>>8&255;b[f++]=c>>16&255;b[f++]=c>>24&255;4294967296>c?f+=4:(c=hi5.NumUtils.splitInt64(c).high,b[f++]=c&255,b[f++]=c>>8&255,b[f++]=c>>16&255,b[f++]=c>>24&255);b[f++]=g&255;
b[f++]=g>>8&255;b[f++]=g>>16&255;b[f++]=g>>24&255;b.set(d,f+4);A(b.buffer)};this.remove=function(b){a(6,b)};this.list=function(b){a(5,b)};this.cancelAll=function(){a(7,"")};this.download=function(){a(136,"")}}function db(a){O||(O=new Db(new Eb));a.setFileHandler(O)}function eb(a,b,c){var g=!1;this.exe=a;this.args=b||"";this._dir=c||"";var d=this;this.close=function(){!g&&L&&(g=!0,A("8C5"+d.exe+"\t"+d.args+"\t"+e.sessionInfo.appInfo.session))}}function Na(a){var b=this;a||(a=143);this.send=function(c){var g=
!!c.buffer,d=g?c:c.getData(),f=64==a;c=g?d.length:c.getEnd()||d.length;c<d.length&&(d=g?d.subarray(0,c):d.slice(0,c));g=f?5:9;c=new Uint8Array(g+c);c[0]=a;if(f)c[1]=b.id,c[2]=b.id>>8,c[3]=b.id>>16,c[4]=b.id>>24;else for(var f=b.name,k=Math.min(f.length,8),e=0;e<k;e++)c[1+e]=f.charCodeAt(e);c.set(d,g);A(c.buffer)};this.name="";this.count=this.id=this.flags=0}function Fb(){var a=window.opener;if(a)try{if(a.__sparkUser&&a.__sparkUser.session)return a.__sparkUser;if(a.opener&&a.opener.__sparkUser.session)return a.opener.__sparkUser}catch(b){}return null}
function fb(){var a="";l&&X(l.connectif)&&l.symlink&&"sessionStorage"in window&&(a="SV_"+l.symlink,l.domain&&(a+=l.domain),l.user&&(a+=l.user));return a}function Gb(){var a=fb(),b="";a&&(b=sessionStorage[a]||"")&&(b="&preSymJoin="+b);return b}function Hb(a,b){var c=0,g=w.size(),d=Array(g),f=Array(g),k=0,x=0,u=0,n=0,r=0,E=0,h="";if(a){f=y.parseMonitorDef(a);for(g=f.length;c<g;c++){var q=f[c];q[0]<u&&(u=q[0]);q[1]<n&&(n=q[1]);q[2]>r&&(r=q[2]);q[3]>E&&(E=q[3])}0>u&&(k=-u);0>n&&(x=-n);q=0>b?[u,n,r,E]:
f[b];l.width=q[2]-q[0]+1;l.height=q[3]-q[1]+1;c=w.getSurface(0);c.setMonitor(q[0],q[1],q[2],q[3]);if(k||x)for(q=c.getMousePosition(),q.left+=k,q.right+=k,q.top+=x,q.bottom+=x,c=0;c<g;c++)q=f[c],q[0]+=k,q[1]+=x,q[2]+=k,q[3]+=x;y.setMonitorLayout(f);0>b&&y.setMonitorCount(0);e.reconnectOnResize=!1;return"&monitorDef="+a+"&width="+l.width+"&height="+l.height}if(1<g&&!U){for(w.verifyMonitors();c<g;c++)q=w.getSurface(c),q=q.getMousePosition(),q.left<u&&(u=q.left),q.top<n&&(n=q.top),q.right>r&&(r=q.right),
q.bottom>E&&(E=q.bottom),d[c]=q,h&&(h+=","),h+=q.left+":"+q.top+":"+q.right+":"+q.bottom;0>u&&(k=-u);0>n&&(x=-n);for(c=0;c<g;c++){q=w.getSurface(c).getMousePosition();if(k||x)q.left+=k,q.right+=k,q.top+=x,q.bottom+=x;f[c]=[q.left,q.top,q.right,q.bottom,q.left==k&&q.top==x?1:0]}y.setMonitorLayout(f);e.reconnectOnResize=!1}h&&(svGlobal.logger.warn("MonitorDef:"+h),l.width=r-u+1,l.height=E-n+1,h="&monitorDef="+h+"&width="+l.width+"&height="+l.height);return h}function gb(){if(!L){ma=!1;U&&la(I,G,!1,
!1);var a="";if(ca)H.init(!1,!0,!1,0);else{a=p+"&width="+I+"&height="+G+"&server_bpp="+na+"&audio="+(F.available||Oa)+Gb()+Hb(l.monitorDef,l.monitor);0>p.indexOf("waWidth")&&(a+=Cb());var b=new Date;l.tzOffset||(a+="&tzOffset="+b.getTimezoneOffset());a+="&time="+b.getTime();void 0==l.soundPref&&(l.soundPref=0,a+="&soundPref=0");var c="",g="";b="";for(b in ha){var d=ha[b];"flags"in d&&(c&&(c+=",",g+=","),c+=d.name,g+=d.flags)}c&&(a=a+("&channelName="+c)+("&channelFlags="+g));c="";for(b in ia)d=ia[b],
"flags"in d&&(c&&(c+=","),c+=d.name);c&&(a+="&gwChannelName="+c);if(d=Fb())b=d.account,d=d.session,b&&(a+="&account="+b),d&&(a+="&session="+d);b=hi5.browser.isTouch&&(1024<=window.innerWidth||768<=window.innerHeight);l.audioRecord=X(l.audioRecord)&&hi5.audio.recordable;H.init(b,!!l.remotefx,l.audioRecord,l.soundPref);l.audioRecord&&(a+="&audioRecord=on");l.decompressingRDP61&&(a+="&decompressingRDP61=on");0<H.count&&(a+="&dvcChannels="+H.names.join(","));hi5.browser.binaryWS()&&(a+="&binary=on");
t.existingFile&&(a+="&existingFile="+t.existingFile);a+="&isTouch="+b+"&gatewayAddr="+encodeURIComponent(qa());a=e.modifyURL(a);t.copyTextOnly&&X(l.mapClipboard)&&(a+="&copyTextOnly=on");(b=hi5.browser.cookie.get("__SV_TOKEN_A"))&&(a+="&__SV_TOKEN_A="+encodeURIComponent(b));(b=svGlobal.Rdp.languageToKeyboard.detect())&&(a+="&_keyboard="+b);t.numLock&&(a+="&numLock="+t.numLock);p=a}b=!0===t.updateFix;void 0==t.wsPost&&(t.wsPost=!1);K?(ca&&(ca.onopen=Pa,ca.onclose=ta,ca.onmessage=function(a){Qa.data=
a.data;K.postMessage(Qa,[Qa.data])}),K.postMessage({type:0,cmd:0,data:{addr:a,width:I,height:G,server_bpp:na,libPath:hi5.libPath,libMin:hi5.libMin,updateFix:b,wsPost:t.wsPost}})):(D=new RdpGeneral(ca||a,I,G,na,y,!1,t.wsPost),b&&D.enableUpdateFix(),D.run());svGlobal.logger.info(p);K?K.addEventListener("message",hb,!1):(D.onopen=Pa,D.onmessage=ib,D.onclose=ta,D.onerror=Ka,D.oninfo=La,D.onloggedin=jb,D.onresolutionchange=function(a,b){la(a,b,!1,l.monitorDef&&0<=l.monitor?!0:!1)},D.onAltSecWindows=kb,
D.onMoveCursor=Ra,D.onCloseSurface=lb,D.onColorChange=sa,D.onHistoryReceived=function(){Sa()},D.onLockKeyState=function(a){if(e.onLockKeyState)e.onLockKeyState(a)});if(a=w.getSurface(w.size()-1))U?a&&(a.remoteApp=new eb(l.exe,l.args,"")):Ea(ra(),a.getWindow());if(l.invitation){var f=null;a&&(f=a.initChat(l.expert));ua=new e.GatewayChannel;ua.name="C_H_A_T";ua.process=function(a){a=a.getUnicodeString(a.getEnd()-a.getPosition(),!0);f&&f.add(a,l.novice)};f&&(f.onchat=function(a){if(L){var b=Array(2*
a.length),b=new hi5.DataBuffer(b,0,b.length);b.setUnicodeString(a);b.markEnd();ua.send(b)}});e.addGatewayChannel(ua)}hi5.browser.isIE&&!va&&(va=hi5.browser.loadFlash(t.flash||hi5.libPath+"plugin.swf"))&&(mb=!0)}}function hb(a){a=a.data;switch(a.type){case 1:switch(a.event){case 0:Pa();break;case 1:ta(a.expected);break;case 2:Ka(a.code);break;case 3:La(a.code);break;case 4:jb();break;case 5:la(a.w,a.h,!1,l.monitorDef&&0<=l.monitor?!0:!1);break;case 6:Ra(a.x,a.y,!0);break;case 7:lb();break;case 8:0==
a.id&&Sa();P&&P.check(1<a.id?15555:0);break;case 9:sa(a.color);break;case 10:if(e.onLockKeyState)e.onLockKeyState(a.state);break;default:svGlobal.logger.warn("Invalid worker event "+a.type)}break;case 2:y.setRGBs(a.x,a.y,a.w,a.h,a.pixel,a.offset,a.scansize);break;case 3:y.moveArea(a.srcx,a.srcy,a.cx,a.cy,a.dx,a.dy);break;case 5:y.fillRect(a.l,a.t,a.w,a.h,a.color);break;case 6:y.drawLine(a.x1,a.y1,a.x2,a.y2,a.color);break;case 7:y.bitBlt(a.opcode,a.dstwidth,a.x,a.y,a.cx,a.cy,a.src,a.srcwidth,a.srcx,
a.srcy);break;case 8:y.drawLineExt(a.x1,a.y1,a.x2,a.y2,a.color,a.opcode);break;case 9:nb(a);break;case 10:ib(a);break;case 11:Q.attach(a.data,0,a.data.length);kb(Q,a.size);break;case 12:y.drawText(a.font,a.flags,a.mixmode,a.foregroundColor,a.backgroundColor,a.clipLeft,a.clipTop,a.clipcx,a.clipcy,a.boxLeft,a.boxTop,a.boxcx,a.boxcy,a.x,a.y,a.length,a.text,a._left,a._top,a._right,a._bottom);break;case 13:y.drawBitmap(a.cacheID,a.cacheIDX,a.x,a.y,a.cx,a.cy,a.srcx,a.srcy,a.opcode);break;case 14:y.saveDesktop(a.x,
a.y,a.cx,a.cy,a.offset);break;case 15:y.restoreDesktop(a.x,a.y,a.cx,a.cy,a.offset);break;case 16:y.putFont(a.font,a.character,a.glyph);break;case 17:y.putCursor(a.idx,a.cursor);break;case 18:y.setCursor(a.idx);break;case 19:y.getHistory(A,function(){K.postMessage({type:0,cmd:7})});P&&P.check(15555);break;case 20:Q.attach(a.data,a.off,a.data.length-a.off);y.setHistory(a.order,Q);break;case 21:y.putBitmap(a.id,a.idx,a.bitmap);break;default:svGlobal.logger.warn("Invalid worker msg "+a.type)}}function ob(a){P&&
P.check(a)}function Pa(){L=!0;if(e.onopen)e.onopen();t.joinCloseMode&&e.setJoinCloseMode(t.joinCloseMode)}function lb(){w&&w.close()}function ib(a){var b=a.data;if("string"!=typeof b){a=new Uint8Array(b);Q.attach(a,0,b.byteLength);var c=Q.getLittleEndian16();switch(c){case 28:a=Q;b=a.getAscllString(8);c=ia[b];null!=c?c.process(a):svGlobal.logger.warn("Channel "+b+" not found");break;case 55:a=Q;switch(a.getByte()){case 0:S=a.getLittleEndian16();W=a.getLittleEndian16();ea=a.getLittleEndian32();a.skipPosition(6);
ja=a.getLittleEndian16();svGlobal.logger.info("Audio Format, tag="+S+" channels="+W+" bitsPerSample="+ja+" samplePerSec="+ea);pb();break;case 1:Ib(a)}P&&P.check();break;case 56:qb(Q.getUnicodeString(Q.getEnd()-Q.getPosition(),!1));break;case 60:rb(Q);break;case 62:sb(Q.getUnicodeString(Q.getEnd()-Q.getPosition(),!1));break;case 63:tb(Q);P&&P.check();break;case 64:b=Q;c=b.getByte();a=b.getLittleEndian32();switch(c){case 1:b=b.getAscllString();if(H[b]&&(H[b].id=a,svGlobal.logger.info("DVC create, name:"+
b+" id:"+a),H[a]=H[b],H[a].onopen))H[a].onopen();break;case 3:H[a]&&H[a].process(b);break;case 4:if(H[a]&&H[a].onclose)H[a].onclose();svGlobal.logger.info("close DVC, id:"+a)}P&&P.check();break;case 146:b=Q;switch(b.getByte()){case 0:a=new Uint8Array(2);a[0]=146;a[1]=1;A(a.buffer);break;case 5:a=b.getByte();b=b.getLittleEndian32();0!=a||b&4||(Z^=65536,w.execute("setFeature",[Z]));break;case 6:T.remoteLockFlags=b.getLittleEndian32();T.checkLockFlags=!0;if(e.onLockKeyState)e.onLockKeyState({capsLock:0!=
(T.remoteLockFlags&4),numLock:0!=(T.remoteLockFlags&2),scrollLock:0!=(T.remoteLockFlags&1)},{capsLock:0!=(T.localLockFlags&4),numLock:0!=(T.localLockFlags&2),scrollLock:0!=(T.localLockFlags&1)});svGlobal.logger.info("remoteLockFlags: "+T.remoteLockFlags)}break;default:if(e.onunknownmessage)e.onunknownmessage(c,Q);else svGlobal.logger.warn("@TODO:"+c+"\n")}}else switch(c=parseInt(b.substring(0,2),16),a=b.substring(2),c){case 0:a=p.substring(p.indexOf("?")+1);A("00"+a);A("87"+navigator.userAgent);break;
case 15:if(e){Ta=!1;oa=e.reconnectTimes;(e&&0==e.mode||X(l.connectif))&&Sa();c="";for(c in ha)if((b=ha[c])&&b.onopen)b.onopen();for(c in ia)if((b=ia[c])&&b.onopen)b.onopen();a&&(a=JSON.parse(a),a.capability&&e&&(e.sessionInfo.suppressOutput=!!a.capability.suppressOutput))}break;case 26:b=JSON.parse(a);if(b.name){b.name="S"+b.name;if(e.onnotify)e.onnotify(b);svGlobal.logger.info("msg="+a);if(b.type&&e.onerror)e.onerror(b);a=__svi18n.errorCode[b.name]||"";a+=b.message;e.showMessage(a,null)}else 0<svGlobal.log&&
console.erro("No error code for message:"+a);break;case 27:w.drawLicense(a);break;case 50:if(L)switch(b=parseInt(a.substring(0,1),10),a=a.substring(1),b){case 1:Jb(a);break;case 2:wa?(wa.type==a?e.writeRawInput("881"+a+"\t"+wa.text):e.writeRawInput("881ERROR\t"),wa=null):!(b=w.getFocused())||b.processClipReq(a)||!t.clipWarnAlways&&ub||!l||l.leagacyMode||(e.showMessage(__svi18n.info.menucopy,null,5E3),ub=!0);break;case 5:(b=w.getFocused())&&"0"!=a&&b.setIgnorePaste(!0)}break;case 51:w.setReadOnly("1"==
a);break;case 54:b=a.split("\t");a=qa()+b[0];a=e.modifyURL(a);svGlobal.logger.info("Downloading file:"+a+" name:"+b[1]+" driver:"+b[2]);e.onprintingready&&e.onprintingready({link:a,printerName:b[1],pinterDriver:b[2]})||(b=w.getFocused())&&b.showPDF(a);break;case 55:b=parseInt(a.substring(0,1),16);a=a.substring(1);switch(b){case 0:a=a.split("\t");S=parseInt(a[0],10);W=parseInt(a[1],10);ja=parseInt(a[2],10);ea=parseInt(a[3],10);svGlobal.logger.debug("Audio Format, tag="+S+" channels="+W+" bitsPerSample="+
ja+" samplePerSec="+ea);pb();break;case 1:Kb(a)}break;case 56:qb(a);break;case 57:b=a.split("\t");svGlobal.logger.debug(a);if(a=w.getWinById(parseInt(b[0]))){if(!w.hasApp(b[1])){(c=w.getOwnerSurface(a))&&c.railWin&&(c.railWin.appId=b[1],c.railWin.addApp(b[1]));if(e.onremoteappstart)e.onremoteappstart({id:b[1]});if(a.isVisible()&&a.titleInfo&&e.ontitlechange)e.ontitlechange(c.railWin.getFullTitle(a.id),b[1])}a.appId=b[1]}break;case 58:b=a;if(O)if(a=parseInt(b.charAt(0),10),b=b.substring(1),5==a)O.notifyFiles(JSON.parse(b));
else switch(b=b.split("\t"),a){case 1:O.confirmId(b[0],b[1],b[2]);break;case 2:O.read(b[0],parseInt(b[1],10),parseInt(b[2],10));break;case 4:O.close(b[0]);break;case 9:a='<a href="'+b[0]+'" download="'+b[1]+'" target="_blank">'+__svi18n.info.fileReady+"</a>",__svi18n.info.download&&w.getFocused().showMessage({msg:a,title:__svi18n.info.download})}break;case 59:a=hi5.Base64.dec(a,0);Z=(new RdpBuffer(a,0,a.length)).getLittleEndian32();if(ka||!(Z&16||Z&65536))Ua=!1,O=null;Z&64&&e.showMessage(__svi18n.info.recording);
O&&(O.setUpload(!(Z&128)),O.setDownload(!(Z&131072)));w.execute("setFeature",[Z]);break;case 60:rb(b64ToBuffer(a));break;case 61:a=JSON.parse(a);switch(a.type){case 0:la(a.width,a.height,!0,!1);sa(a.color);(b=a.server)&&e&&(e.server=a.server);vb=a.length;c=w.getFocused();U=1==a.isRail;c&&(c.setAutoScale(!U),b&&Ea(ra(),c.getWindow()),b=a.keyboard,"undefined"!=typeof b&&0==b&&c.setUnicode(!0),b=a.mapDisk)&&(Ua=!0,db(c));if(e.onopened)e.onopened(a);break;case 1:a=a.duration;if(e.onprogress)e.onprogress(a,
vb);break;case 2:2==a.status?(Ma(),L=!0):(b=0==a.status,b==y.isPaused()||e.onsessionpause&&e.onsessionpause(b,a)||(y.pause(b),b||w.repaint(0,0,y.width-1,y.height-1),a.warn&&e.showMessage(b?__svi18n.info.sessionPaused:__svi18n.info.sessionResumed)))}break;case 62:sb(a);break;case 63:tb(b64ToBuffer(a));break;default:if(e.onunknownmessage)e.onunknownmessage(c,a);else svGlobal.logger.warn("@TODO:"+b+"\n")}}function Sa(){if(!ka&&!V&&(V=!0,e&&(t.pingInterval&&e.startPing(t.pingInterval),e.onready)))e.onready()}
function Lb(a,b){var c=0,g=!1;this.width=a;this.interval=b;var d=0;this.start=function(){g||(g=!0,c=setInterval(function(){var b=w.getFocused();b&&L&&(b=b.getThumbnail(a))&&b.length!=d&&(A("8E7"+b),d=b.length)},b))};this.stop=function(){clearInterval(c)}}function Mb(a,b){!Y||Y.width==a&&Y.interval==b||(Y.stop(),Y=null);Y||(Y=new Lb(a,b));Y.start()}function tb(a){var b=a.getAscllString(8);(b=ha[b])&&b.process&&b.process(a)}function sb(a){var b=parseInt(a.substring(0,1),16),c=a.substring(1);a=!1;var g=
e.sessionInfo.appInfo;switch(b){case 0:var d=JSON.parse(c);Ma();L=!0;a=d.width;b=d.height;if(a==I&&b==G)break;la(a,b,!1,!1);break;case 1:d=JSON.parse(c);e.sessionInfo.joinedSessions.push(d.numericId);g.sessions[d.numericId]=d.name||d.__ip;if(!g.joined||t.alertJoin)e.onsessionjoin&&(a=e.onsessionjoin(d)),!a&&__svi18n.info.joinsession&&e.showMessage(__svi18n.info.joinsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 2:d=JSON.parse(c);e.sessionInfo.joinedSessions.removeElm(d.numericId);delete g.sessions[d.numericId];
if(!g.joined||t.alertJoin)e.onsessionexit&&(a=e.onsessionexit(d)),!a&&__svi18n.info.exitsession&&e.showMessage(__svi18n.info.exitsession.applyArgs([d.numericId,d.__ip,d.name]));break;case 3:d=JSON.parse(c);g.joinMode!=d.mode&&(g.joinMode=d.mode,b=hi5.$("joinSelect"))&&(b.value=d.mode);if(g.hasControl)break;g.hasControl=!0;w.setReadOnly(!1,2==d.mode);if(b=hi5.$("requestControl"))b.disabled=!0;e.ongivecontrol&&(a=e.ongivecontrol());if(a)break;e.showMessage(__svi18n.info.givecontrol,null,5E3);break;
case 4:d=JSON.parse(c);w.setReadOnly(!0,2==d.mode);g.hasControl=!1;if(b=hi5.$("requestControl"))b.disabled=!1;e.ontakebackcontrol&&(a=e.ontakebackcontrol());if(a)break;e.showMessage(__svi18n.info.nocontrol,null,5E3);break;case 5:d=JSON.parse(c);e.onrequirecontrol&&(a=e.onrequirecontrol(d));if(a)break;a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]);b=__svi18n.info.recontrol;y.isPaused&&(b+="<br><br>"+(__svi18n.info.autoresume||""));hi5.notifications.notify({title:a,msg:b,cbYes:function(){e.giveControl(d.numericId);
this.destroy();y.isPaused()&&e.pauseSession(e.sessionInfo.appInfo.numericId,!1)},cbNo:function(){e.refuseControl(d.numericId);this.destroy()}});break;case 6:w.execute("setTouchRemoting",[!0]);break;case 7:d=JSON.parse(c);d.width&&d.height&&la(d.width,d.height,!0,l.monitorDef&&0<=l.monitor?!0:!1);d.color&&(sa(d.color,!0),svGlobal.logger.warn("Color depth changed to:"+d.color));d.version&&(e.sessionInfo.protocolVersion=d.version);break;case 8:d=JSON.parse(c);Ta=!0;if(e.onrequestcredential&&e.onrequestcredential(d,
T.reconnect))break;if(e.onautherror&&e.onautherror(d,T.reconnect))break;w.getFocused().requestCredential(d,T.reconnect);break;case 9:d=JSON.parse(c);0<d.interval&&0<d.width?Mb(d.width,d.interval):Y&&(Y.stop(),Y=null);break;case 11:d=JSON.parse(c),e.onrequirejoin&&(a=e.onrequirejoin(d)),a||(a=__svi18n.info.title.applyArgs([d.name,d.numericId,d.__ip]),hi5.notifications.notify({title:a,msg:__svi18n.info.reqjoin,cbYes:function(){e.allowJoin(d.numericId,!0);this.destroy()},cbNo:function(){e.allowJoin(d.numericId,
!1);this.destroy()}}))}}function rb(a){switch(a.getByte()){case 32:if(!y.isPaused()){var b=a.getLittleEndian16(),c=a.getLittleEndian16(),g=a.getLittleEndian16(),d=void 0,f=void 0;t.noCursorName||(d=a.getLittleEndian32(),e.sessionInfo.appInfo&&(f=e.sessionInfo.appInfo.sessions[d]));Ra(c,g,!0,f,d,b)}}}function Ra(a,b,c,g,d,f){y.isPaused()||w.getFocused().moveCursor(a,b,c,g,d,f)}function nb(a){w.setCursor(a)}function qb(a){a=JSON.parse(a);wb=a.session;a.server||(a.server=ra());var b=hi5.$("joinSelect");
b&&(b.value=a.joinMode);if(b=hi5.$("requestControl"))b.disabled=a.hasControl;a.joined?w.execute("setAutoScale",[!0]):(e.mode=0,X(l.connectif)&&w.setSize(I,G),t.disableJoinedAppResize&&(e.windowState=0));var b=t.page&&t.page.join||"join.html",c=qa(),b=c+"/"+b+"?id="+(a.joined||a.numericId),g=a.webAddress;g&&0<g.length&&g.toLowerCase()!=c.toLowerCase()&&(c=g.indexOf("://"),e.protocol="http"==g.substring(0,c)?"ws":"wss",e.gateway=g,b+="&gateway="+encodeURIComponent(g));b=e.modifyURL(b);a.joinLink=b;
e.sessionInfo.appInfo=a;"isApp"in a&&U!==a.isApp&&(U=a.isApp,bb(),w.setSize(I,G,U?"hidden":null),y=$a(I,G),ma||w.execute("setAutoScale",[!0]));a.ver&&a.ver!=svGlobal.version&&svGlobal.logger.warn("Client:"+svGlobal.version+" server:"+a.ver);t.cursorNameOnly=a.isAssistance;if(e.onsessionstart)e.onsessionstart(e.sessionInfo)}function Kb(a){function b(a){var b=0;a*=f;for(k=0;k<f;k++)b|=(d[a+k]&255)<<8*k;b>e?(b-=n,b/=-u):b/=e;return b}if(F.available&&!y.isPaused()){var c=a.indexOf("\t"),g=a.substring(0,
c),d=hi5.Base64.dec(a,c+1);1!=S&&(pa||(pa=new MSGSM),d=pa.decode(d,0,d.length));a=ja;var f=a>>3,k=0,e=Math.pow(2,a-1)-1,u=-e-1,n=Math.pow(2,a);a=0;var c=W,r=Math.floor(Math.floor(d.length/f)/c),E=F.getBuffer(r),h=E.getChannelData(0),q=E.getChannelData(1);for(a=0;a<r;){var l=2*a,p=b(l);1==c?(h[a]=p,q[a]=p):(h[a]=p,q[a]=b(l+1));a++}a=F.playBuffer(E);setTimeout(function(a){return function(){A("8A"+a)}}(g),1E3*(a-F.delay))}}function Ib(a){function b(a){return function(){A("8A"+a)}}var c=a.getByte(),g=
a.getLittleEndian16(),d=Date.now();a.skipPosition(8);a=Va(a,c,g,0);a=1E3*(a-F.delay);ka||(g+=Date.now()-d+a,setTimeout(b(c+","+g),a))}function Va(a,b,c,g){if(!mb||y.isPaused())return 0;var d=c=0,f=a.getPosition();b=a.getData();g||(g=a.getEnd()-f);var k=g;if(41222==S)return(c=F.getContext())&&c.decodeAudioData(b.buffer.slice(f),function(a){a=F.playBuffer(a);ka||setTimeout(sendLater(La),1E3*(a-F.delay))},function(a){svGlobal.logger.warn(a)}),0;if(d=1!=S)pa||(pa=new MSGSM),b=pa.decode(b,f,k),f=0,k=b.length;
var e=ja,u=e>>3,n=Math.floor(k/u),r=a=0,E=0;d||(a=Math.pow(2,e-1)-1,r=-a-1,E=Math.pow(2,e));e=W;if(va){f="";if(d){for(;c<k;c++)0<c&&(f+=","),f+=b[c]+","+b[c]+","+b[c]+","+b[c];va.write(f);return g/65*.025}for(;c<k;)0<c&&(f+=","),d=b[c++]|b[c++]<<8,9>d?d=0:d>a?(d-=E,d/=-r):d/=a,f+=d,1==e&&(f+=","+d);va.write(f);return g/u/ea*.6}g=f;f=Math.floor(n/e);k=F.getBuffer(f);u=k.getChannelData(0);n=k.getChannelData(1);c=0;if(d)for(;c<f;)1==e?n[c]=u[c]=b[g++]:(u[c]=b[g++],n[c]=b[g++]),c++;else for(;c<f;)d=b[g++]|
b[g++]<<8,d>a?(d-=E,d/=-r):d/=a,1==e?u[c]=d:(u[c]=d,d=b[g++]|b[g++]<<8,d>a?(d-=E,d/=-r):d/=a),n[c]=d,c++;return F.playBuffer(k)}function pb(){K&&K.postMessage({type:0,cmd:5,data:{tag:S,channels:W,samplePerSec:ea,bitsPerSample:ja}})}function Nb(a){if(!e.openLink||2E3<a.length)return!1;var b=a.indexOf(";");0<b&&(a=a.substring(b+1));b=a;a=a.toLowerCase();var c=0==a.indexOf("http://")||0==a.indexOf("https://")||0==a.indexOf("ftp://")||0==a.indexOf("mailto:")||0==a.indexOf("tel:")||0==a.indexOf("callto:");
c||(0==a.indexOf("www.")?(c=!0,a="http://"+a):0==a.indexOf("ftp.")&&(c=!0,a="ftp://"+a));if(c){if(0<a.indexOf("\r")||0<a.indexOf("\n"))return!1;if(e.onurlredirection&&e.onurlredirection(c))return!0;a=w.getFocused();if(!a)return!1;a.processLink(b);return!0}return!1}function Jb(a){"text/plain;"!=a&&(1666<Date.now()-T.reqCopyTime&&(e.onservercopy&&e.onservercopy(a)||Nb(a)||w.copyToClip(a)),setTimeout(function(){A("883")},999))}function jb(){if(!ma&&(setTimeout(function(){L&&A("884")},333),e.onloggedin))e.onloggedin();
Wa=ma=!0;U&&w.execute("setAutoScale",[!1]);O&&(O.enabled=!0);Ba&&!U&&(y.setContext(w.getFocused().context),w.repaint(0,0,y.width-1,y.height-1))}function ta(a){if(e){svGlobal.logger.warn("closed "+(e.sessionInfo.appInfo?e.sessionInfo.appInfo.numericId:0));var b=fb();b&&e.sessionInfo.appInfo&&0==e.mode&&(sessionStorage[b]=e.sessionInfo.appInfo.session);if(e&&(b=0==e.mode,!L&&b&&Ka("connection"),b=b&&(L||oa<e.reconnectTimes)&&0<oa&&!a,V=L=!1,b)){oa--;__svi18n.info.reconnecting&&e.showMessage(__svi18n.info.reconnecting+
" "+(e.reconnectTimes-oa)+"/"+e.reconnectTimes,null,3E3);setTimeout(gb,5);svGlobal.logger.info("Reconnecting..."+oa);return}if(Ta)svGlobal.logger.info("Req credential");else{K&&(K.postMessage({type:0,cmd:4}),K.removeEventListener("message",hb,!1));O&&(O.release(),O=null);N=p=null;H&&(H.close(),H=null);ha&&hi5.Arrays.release(ha);ia&&hi5.Arrays.release(ia);Y&&(Y.stop(),Y=null);F&&(F.close(),F=null);try{if(e.onclose)e.onclose(a);else svGlobal.logger.info("onclose: null");w&&(w.close(),w=null)}catch(c){}Q=
null;D&&(D.onopen=null,D.onmessage=null,D.onclose=null,D.onerror=null,D.close(),D=null);w=T=null;y&&(y.release(),y=null);hi5.browser.isChromeApp?chrome.runtime.onSuspend.removeListener(e.close):window.removeEventListener("unload",e.close,!1);e=null;window&&window.$rdp==this&&(window.$rdp=null)}}}function xb(){D&&L?D.close():ta(!0)}function kb(a,b){var c=a.getLittleEndian32();if(0!=(c&16777216)){var g=a.getLittleEndian32();if(0!=(c&1073741824)){a.getLittleEndian16();a.getByte();var c=a.getByte(),d=
a.getLittleEndian16(),f=a.getLittleEndian16(),k=0;16>c&&(k=a.getLittleEndian16());var e=a.getLittleEndian16(),u=a.getLittleEndian16();a.getBytes(e);k&&a.getBytes(k);if(8<=c&&(k=w.getFocused())&&k.onremoteappicon){e=new hi5.graphic.Bitmap(d,f,32);a.getPosition();for(var d=new Uint8Array(d*f*4),f=a.getPosition(),u=f+u,n,r=a.getData(),E=0,h,q;f<u;)switch(c){case 16:(n=r[f++]|r[f++]<<8)?(q=n>>7&248,h=n>>2&248,n=n<<3&248,q|=q>>5,h|=h>>5,n|=n>>5,d[E++]=n,d[E++]=h,d[E++]=q,d[E++]=255):E+=4;break;case 32:d[E++]=
r[f++],d[E++]=r[f++],d[E++]=r[f++],d[E++]=r[f++]}e.putPixels(d,0,d.length);g=w.getWinById(g);k.onremoteappicon(g,e)}}else 0!=(c&2147483648)?svGlobal.logger.info("XXX rail cache icon, winId="+g):0!=(c&536870912)?(svGlobal.logger.info("***** delete winId="+g),w.delWin(g)):Ob(a,c,g)}else if(0!=(c&33554432))svGlobal.logger.info("XXX Alt Sec window Notify="+c);else if(0!=(c&67108864))if(svGlobal.logger.info("*** -- Alt Sec window Desktop="+c),0!=(c&1))svGlobal.logger.info("Desktop non monitored flags="+
c);else{if(0!=(c&32)&&(g=a.getLittleEndian32(),svGlobal.logger.info("Desktop monitored flags="+c+" winId="+g),w.setTitle(g),y.getContext()||(g=w.getFocused())&&y.setContext(g.context),0!=(c&16)&&(g=a.getByte(),0<g)))for(c=w.zOrders,c.length=g,k=0;k<g;k++)c[k]=a.getLittleEndian32(),svGlobal.logger.info("---zorders:"+c[k])}else svGlobal.logger.info("XXX Alt Sec window order flgas="+c)}function Ob(a,b,c){U||(U=!0);var g=0==(b&268435456);svGlobal.logger.info("\n\n=========== winId="+c+" existed="+g);
var d=w.getWinById(c);d?g=!0:d=new w.LocalWin(c);if(d){0!=(b&2)&&(d.ownerWinid=a.getLittleEndian32(),svGlobal.logger.info("***** ownerWinid="+d.ownerWinid));0!=(b&8)&&(d.style=a.getLittleEndian32(),d.extStyle=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" style="+d.style+" extStyle="+d.extStyle),svGlobal.logger.info("*****--- WS_POPUP="+(0!=(d.style&2147483648))),svGlobal.logger.info("*****--- WS_DLGFRAME="+(0!=(d.style&4194304))),svGlobal.logger.info("*****--- DS_MODALFRAME="+(0!=
(d.style&128))),svGlobal.logger.info("*****--- WS_EX_DLGMODALFRAME="+(0!=(d.extStyle&1))),svGlobal.logger.info("*****--- WS_EX_TOOLWINDOW="+(0!=(d.extStyle&128))),svGlobal.logger.info("*****--- WS_BORDER="+(0!=(d.style&8388608))),svGlobal.logger.info("*****--- WS_CAPTION="+(0!=(d.style&12582912))),svGlobal.logger.info("*****--- WS_OVERLAPPED="+(0!=(d.style&0))),svGlobal.logger.info("*****--- WS_OVERLAPPEDWINDOW="+(0!=(d.style&13565952))),svGlobal.logger.info("*****--- WS_POPUPWINDOW="+(0!=(d.style&
2156396544))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_CHILD="+(0!=(d.style&1073741824))),svGlobal.logger.info("*****--- WS_SIZEBOX="+(0!=(d.style&262144))),svGlobal.logger.info("*****--- WS_EX_MDICHILD="+(0!=(d.extStyle&64))),svGlobal.logger.info("*****--- WS_EX_LAYERED="+(0!=(d.extStyle&524288))));0!=(b&16)&&(d.setShowState(a.getByte()),svGlobal.logger.info("***** winId="+c+" showState="+d.showState),2==d.showState&&0!=t.noMinimize&&setTimeout(function(){d.exeCommand(61728)},
50));var f=0!=(b&4);if(f){var k=a.getLittleEndian16();d.titleInfo=a.getUnicodeString(k,!1);svGlobal.logger.info("***** winId="+c+" title="+d.titleInfo)}0!=(b&16384)&&(d.clientOffsetX=a.getLittleEndian32(),d.clientOffsetY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" coffX"+d.clientOffsetX+" coffY="+d.clientOffsetY));0!=(b&65536)&&(d.clientAreaWidth=a.getLittleEndian32(),d.clientAreaHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" cw"+d.clientAreaWidth+" ch="+d.clientAreaHeight));
0!=(b&131072)&&(d.rpContent=a.getLittleEndian32());0!=(b&262144)&&(d.rootParentHandle=a.getLittleEndian32());if(0!=(b&2048)){var k=a.getLittleEndian32(),x=a.getLittleEndian32();d.winOffsetX=k;d.winOffsetY=x;svGlobal.logger.info("***** winId="+c+" offX"+d.winOffsetX+" offY="+d.winOffsetY)}0!=(b&32768)&&(d.winClientDeltaX=a.getLittleEndian32(),d.winClientDeltaY=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" dX"+d.winClientDeltaX+" dY="+d.winClientDeltaY));0!=(b&1024)&&(d.winWidth=a.getLittleEndian32(),
d.winHeight=a.getLittleEndian32(),svGlobal.logger.info("***** winId="+c+" w"+d.winWidth+" h="+d.winHeight),g&&(k=w.getFocused())&&k.railWin.mainWin==d&&(k=k.getFreeSpace(),x=d.winHeight-k.height,svGlobal.logger.info("--- offset:"+x+" win._hOffset:"+d._hOffset+" appId:"+d.appId),16<x&&50>x&&(!d._hOffset||16<x-d._hOffset)&&(d._hOffset=x,e.writeRawInput("8C661441\t"+k.width+"\t"+(k.height-x)))));0!=(b&256)&&(k=a.getLittleEndian16(),0<k&&a.skipPosition(8*k));0!=(b&4096)&&(d.visibleOffsetX=a.getLittleEndian32(),
d.visibleOffsetY=a.getLittleEndian32());0!=(b&512)&&(b=a.getLittleEndian16(),d.numVisibilityRects=b,0<b&&a.skipPosition(8*b));if(g)w.onWinChange(d);else w.addWin(d);f&&w.setTitle(c)}else svGlobal.logger.warn("XXX, No win with id:"+c)}function ab(a,b){function c(a,b,d,f,c){0<c.width?c.union(a,b,d,f):(c.x=a,c.y=b,c.width=d,c.height=f)}function g(a,b,d,c){for(G=0;G<H;G++){var v=J[G];if(a>=v[0]&&b>=v[1]&&d<=v[2]&&c<=v[3])return I[G]}return null}function d(a,b,d,f){if(H){var v=g(a,b,a+d-1,b+f-1);v&&c(a,
b,d,f,v)}else c(a,b,d,f,p)}function f(a,b,d,c,f,k,g){for(var v=f*d+c,m=a.setRGB,B=a.getRGB,z=0;z<g;z++){for(var e=0;e<k;e++){if(a){var aa=B(c+e,f+z);m(c+e,f+z,~aa&16777215)}else b[v]=~b[v]&16777215;v++}v+=d-k}}function k(a,b,d,c,f,k,e,g,h,n){b=n*g+h;null==e&&(e=a);for(a=0;a<k;a++){for(h=0;h<f;h++)q[c+a][d+h]=q[c+a][d+h]&e[b]&16777215|4278190080,b++;b+=g-f}}function e(a,b,d,c,f,k,e,g,h,q){b=q*g+h;h=a.setRGB;q=a.getRGB;null==e&&(e=a);for(a=0;a<k;a++){for(var v=0;v<f;v++){var m=q(d+v,c+a);h(d+v,c+a,
m|e[b]&16777215);b++}b+=g-f}}function u(a,b,d,c){var f=R;if(f){var v=f.getRGB(b,d);switch(a){case 0:f.setRGB(b,d,0);break;case 1:f.setRGB(b,d,~(v|c)&16777215);break;case 2:f.setRGB(b,d,v&~c&16777215);break;case 3:f.setRGB(b,d,~c&16777215);break;case 4:f.setRGB(b,d,16777215*(~v&c));break;case 5:f.setRGB(b,d,~v&16777215);break;case 6:f.setRGB(b,d,v^c&16777215);break;case 7:f.setRGB(b,d,~v&c&16777215);break;case 8:f.setRGB(b,d,v&c&16777215);break;case 9:f.setRGB(b,d,v^~c&16777215);break;case 10:break;
case 11:f.setRGB(b,d,v|~c&16777215);break;case 12:f.setRGB(b,d,c);break;case 13:f.setRGB(b,d,(~v|c)&16777215);break;case 14:f.setRGB(b,d,v|c&16777215);break;case 15:f.setRGB(b,d,16777215);break;default:svGlobal.logger.warn("unsupported pixel opcode: "+a),f.setRGB(b,d,c)}}}function n(a,b,d,f,c,k,e,g,h){a>g||b>h||(d=a+d-1,d>g&&(d=g),a<k&&(a=k),d=d-a+1,f=b+f-1,f>h&&(f=h),b<e&&(b=e),f=f-b+1,1>d||1>f||R.fillRect(a,b,d,f,c))}function r(a,b,d,f,c,k,e,g,h,n,r,x){if(!(b>r||d>x)){var v=b+f-1;v>r&&(v=r);h=b<
h?h:b;v=v-b+1;r=d+c-1;r>x&&(r=x);n=d<n?n:d;x=r-d+1;if(!(1>v||1>x)){r=128;var m=0;e|=4278190080;g|=4278190080;if(h==b&&n==d&&v==f&&x==c)if(0==a)for(var B=0;B<c;B++){a=d+B;for(var z=0;z<f;z++)0==r&&(m++,r=128),0!=(k[m]&r)&&(q[a][b+z]=g),r>>=1;m++;r=128;m==k.length&&(m=0)}else for(B=0;B<c;B++){a=d+B;for(z=0;z<f;z++)0==r&&(m++,r=128),q[a][b+z]=0!=(k[m]&r)?g:e,r>>=1;m++;r=128;m==k.length&&(m=0)}else if(0==a)for(B=0;B<x;B++){a=d+B;for(z=0;z<v;z++)0==r&&(m++,r=128),b+z>=h&&a>=n&&0!=(k[m]&r)&&(q[a][b+z]=
g),r>>=1;m++;r=128;m==k.length&&(m=0)}else for(B=0;B<x;B++){a=d+B;for(z=0;z<v;z++)0==r&&(m++,r=128),b+z>=h&&d+B>=n&&(q[a][b+z]=0!=(k[m]&r)?g:e),r>>=1;m++;r=128;m==k.length&&(m=0)}}}}function E(a,b,d,f,c){this.offset=a;this.baseLine=b;this.width=d;this.height=f;this.fontData=c}function h(a,b,d,f,c,k,g,e,h){this.cache_idx=a;this.rawData=b;this.none=!b;this.hotX=d;this.hotY=f;this.width=c;this.height=k;this.xorSize=e;this.andSize=h;this.result="";this.distance=0;this.bpp=g;this.system="";if(b){if(!this.distance){a=
0;if(b){g=0;for(var v=b.length;g<v;g++)0!=b[g]&&(a+=g%c+(g/c|0))}this.distance=a}if(!this.system){a:switch(this.distance){case 507:a="text";break a;case 2046:case 4359:a="default";break a;default:a=""}this.system=a}}a="";if(!this.system&&b){g=c*k*4;a=62+g+e+h;v=new Uint8Array(a);a=new hi5.DataBuffer(v,0,a);a.setLittleEndian16(0);a.setLittleEndian16(2);a.setLittleEndian16(1);a.setByte(c);a.setByte(k);a.setByte(0);a.setByte(0);a.setLittleEndian16(d);a.setLittleEndian16(f);a.setLittleEndian32(40+g+e+
h);a.setLittleEndian32(22);a.setLittleEndian32(40);a.setLittleEndian32(c);a.setLittleEndian32(2*k);a.setLittleEndian16(1);a.setLittleEndian16(32);a.setLittleEndian32(0);a.setLittleEndian32(e+h);a.setLittleEndian32(0);a.setLittleEndian32(0);a.setLittleEndian32(0);a.setLittleEndian32(0);for(d=k-1;0<=d;d--)for(f=0;f<c;f++)k=b[c*d+f],a.setByte(k&255),a.setByte(k>>8&255),a.setByte(k>>16&255),a.setByte(k>>24&255);a="data:image/x-icon;base64,"+hi5.Base64.enc(a.getData())}this.url=a}var q=[],l=null,p=new hi5.graphic.Rectangle(0,
0,0,0),w="Uint8ClampedArray"in window,t=null,y=0,A=0,C=0,D=0,da=null,J,I,G=0,H=0;this.width=a;this.height=b;var ga=!1,R=this,ba={imgData:null,left:0,top:0,width:0,height:0};this.setProfiler=function(a){t=a};this.getDirtyArea=function(){return p};this.setImgRect=function(a,b,d,f){y=a;A=b;C=d;D=f};this.parseMonitorDef=function(a){var b=a.split(","),d=b.length,f=[];if(1<d){for(var c=!1,k=0;k<d;k++){var g=b[k].split(":");if(4==g.length)f[k]=Array(5),f[k][0]=parseInt(g[0]),f[k][1]=parseInt(g[1]),f[k][2]=
parseInt(g[2]),f[k][3]=parseInt(g[3]),f[k][4]=0==f[k][0]&&0==f[k][1]?1:0;else{c=!0;break}}c&&(svGlobal.logger.warn("invaiid monitorDef:"+a),f.length=0)}return f};this.setMonitorLayout=function(a){var b=a.length,d=0;J=a;for(I=Array(b);d<b;d++)I[d]=new hi5.graphic.Rectangle(0,0,0,0);H=b};this.setMonitorCount=function(a){H=a};this.addImg=function(a){C&&(da&&URL.revokeObjectURL(da.src),da=a)};this.flushImgs=function(){da&&(URL.revokeObjectURL(da.src),da=null,C=0)};this.getData=function(){return q};this.pause=
function(a){ga=a};this.release=function(){p=null;hi5.Arrays.release(I);R.flushImgs();q=l=R=null;ba=ba.imgData=null};this.isPaused=function(){return ga};this.setContext=function(d){d!=l&&(l||!d||d.createImageData(1,1).data.buffer||(w=!1),l=d,null!=l&&(ba.imgData=l.createImageData(a,b)))};this.getContext=function(){return l};this.resize=function(d,f){if(q.length!=f||q[0].length!=d){for(var c=0;c<f;c++)q[c]=new Uint32Array(d);q.length=f;R.width=a=d;R.height=b=f;null!=l&&(ba.imgData=l.createImageData(a,
b))}};R.resize(a,b);this.getBuffer=function(){return q};this.setRGB=function(a,b,d){q[b][a]=d|4278190080};this.getRGB=function(a,b){return q[b][a]};this.setRGBs=function(f,c,k,g,e,h,r){var v,m=f+k,z=c+g;z>b&&(z=b);if(!(f>=a)){m>=a&&(m=a);if(e.subarray)for(var B=c;B<z;B++,h+=r)q[B].set(e.subarray(h,h+k),f);else for(var n,B=c;B<z;B++,h+=r){var Xa=h;n=q[B];for(v=f;v<m;v++)n[v]=e[Xa++]}d(f,c,k,g)}};this.moveArea=function(a,b,f,c,k,g){if(0<g){var v=a+k,e=b+g,m,h;if(q[0].set)for(h=c-1;0<=h;h--)q[e+h].set(q[b+
h].subarray(a,a+f),v);else for(h=c-1;0<=h;h--){var z=q[e+h],r=q[b+h];for(m=0;m<f;m++)z[v+m]=r[a+m]}}else if(0>g)if(v=a+k,e=b+g,h=0,q[0].set)for(;h<c;h++)q[e+h].set(q[b+h].subarray(a,a+f),v);else for(;h<c;h++)for(z=q[e+h],r=q[b+h],m=0;m<f;m++)z[v+m]=r[a+m];else if(0<k)for(v=a+k,e=b+g,m=f-1;0<=m;m--)for(z=v+m,r=a+m,h=0;h<c;h++)q[e+h][z]=q[b+h][r];else for(v=a+k,e=b+g,m=0;m<f;m++)for(z=v+m,r=a+m,h=0;h<c;h++)q[e+h][z]=q[b+h][r];d(a+k,b+g,f,c)};this.getRGBs=function(a,b,d,f,c){var k=new Uint32Array(d*
f),g=a+d;f=b+f;for(var m=0;b<f;b++)k.set(q[b].subarray(a,g),m),m+=d;c(k)};this.repaint=function(d,f,c,k){var g=ba.imgData.data,m=0,e,h;t&&t.begin("paint");0>d&&(c+=d,d=0);0>f&&(k+=f,f=0);d+c>a&&(c=a-d);f+k>b&&(k=b-f);var v=d+c;var z=f+k;if(w)for(g=new Uint32Array(g.buffer),h=f;h<z;h++)g.set(q[h].subarray(d,v),m),m+=a;else{var r=4*(a-c)|0;for(h=f;h<z;h++){for(e=d;e<v;e++){var n=q[h][e];g[m++]=n&255;g[m++]=n>>8&255;g[m++]=n>>16&255;g[m++]=255}m+=r}}ba.left=d;ba.top=f;ba.width=c;ba.height=k;t&&t.end("paint");
return ba};this.postPaint=d;this.draw=function(a,b,d,f){if(l&&!ga)if(da&&da.complete&&(l.drawImage(da,y,A,C,D),URL.revokeObjectURL(da.src),da=null),H){if(a=g(a,b,d,f),a.width)return R.repaint(a.x,a.y,a.width,a.height),a.width=0,ba}else if(p.width)return R.repaint(p.x,p.y,p.width,p.height),p.width=0,ba;return null};this.fillRect=function(a,b,f,c,k){var g=a+f,e=b+c;if(q[0].fill)for(var m,h=b;h<e;h++)q[h].fill(k,a,g);else for(h=b;h<e;h++)for(m=a;m<g;m++)q[h][m]=k;d(a,b,f,c)};this.drawLine=function(a,
b,d,f,c){if(b==f){if(a>d){var k=a;a=d;d=k}var g=q[b];d++;if(g.fill)g.fill(c,a,d);else for(k=a;k<d;k++)g[k]=c}else if(a==d)for(b>f&&(k=b,b=f,f=k),f++,k=b;k<f;k++)q[k][a]=c;else{var h=Math.abs(d-a),e=Math.abs(f-b);k=a;var g=b;d=d>=a?a=1:a=-1;b=f>=b?f=1:f=-1;if(h>=e){b=a=0;var m=h;var v=h/2|0;var r=e}else f=d=0,m=e,v=e/2|0,r=h,h=e;if(!(1>h))for(h++,e=0;e<h;e++)q[g][k]=c,v+=r,v>=m&&(v-=m,k+=a,g+=f),k+=d,g+=b}};this.bitBlt=function(a,b,c,g,h,r,n,x,l,u){var m=R;switch(a){case 0:x=m.setRGB;for(m=c;m<c+h;m++)for(l=
g;l<g+r;l++)x(m,l,0);break;case 1:a=n;l=u*x+l;u=m.setRGB;b=m.getRGB;null==a&&(a=m);for(m=0;m<r;m++){for(n=0;n<h;n++)u(c+h,g+r,~(b(c+h,g+r)|a[l])&16777215);l+=x-h}break;case 2:a=n;l=u*x+l;u=m.setRGB;b=m.getRGB;null==a&&(a=m);for(m=0;m<r;m++){for(n=0;n<h;n++){var v=b(c+h,g+r);u(c+h,g+r,v&~a[l]&16777215);l++}l+=x-h}break;case 3:f(m,n,x,l,u,h,r);n?m.setRGBs(c,g,h,r,n,u*x+l,x):m.moveArea(l,u,h,r,c-l,g-u);break;case 4:f(m,null,b,c,g,h,r);k(m,b,c,g,h,r,n,x,l,u);break;case 5:f(m,null,b,c,g,h,r);break;case 6:a=
n;l=u*x+l;null==a&&(a=m);for(m=0;m<r;m++){for(u=0;u<h;u++)q[g+m][c+u]=q[g+m][c+u]^a[l]&16777215|4278190080,l++;l+=x-h}break;case 7:a=n;l=u*x+l;u=m.setRGB;b=m.getRGB;null==a&&(a=m);for(m=0;m<r;m++){for(n=0;n<h;n++)v=b(c+n,g+m),u(c+n,g+m,~(v&a[l])&16777215),l++;l+=x-h}break;case 8:k(m,b,c,g,h,r,n,x,l,u);break;case 9:a=n;l=u*x+l;u=m.setRGB;b=m.getRGB;null==a&&(a=m);for(m=0;m<r;m++){for(n=0;n<h;n++)v=b(c+n,g+m),u(c+n,g+m,v^~a[l]&16777215),l++;l+=x-h}break;case 10:break;case 11:a=n;l=u*x+l;u=m.setRGB;
b=m.getRGB;null==a&&(a=m);for(m=0;m<r;m++){for(n=0;n<h;n++)v=b(c+n,g+m),u(c+n,g+m,v|~a[l]&16777215),l++;l+=x-h}break;case 12:n?m.setRGBs(c,g,h,r,n,u*x+l,x):m.moveArea(l,u,h,r,c-l,g-u);break;case 13:f(m,null,b,c,g,h,r);e(m,b,c,g,h,r,n,x,l,u);break;case 14:e(m,b,c,g,h,r,n,x,l,u);break;case 15:x=m.setRGB;for(m=c;m<c+h;m++)for(l=g;l<g+r;l++)x(m,l,16777215);break;default:svGlobal.logger.warn("unsupported opcode: "+a)}d(c,g,h,r)};this.drawLineExt=function(a,b,f,c,k,g){if(a==f||b==c){var h;if(b==c)if(f>
a){var m=f-a;if(!(1>m))for(h=0;h<m;h++)u(g,a+h,b,k)}else{if(m=a-f,!(1>m))for(h=0;h<m;h++)u(g,f+h,b,k)}else if(c>b){if(m=c-b,!(1>m))for(h=0;h<m;h++)u(g,a,b+h,k)}else if(m=b-c,!(1>m))for(h=0;h<m;h++)u(g,a,c+h,k)}else{var e=Math.abs(f-a),r=Math.abs(c-b);h=a;m=b;var n,v;var l=f>=a?n=1:n=-1;var q=c>=b?v=1:v=-1;if(e>=r){q=n=0;var x=e;var z=e/2>>0;var p=r}else v=l=0,x=r,z=r/2>>0,p=e,e=r;if(1>e)return;for(r=0;r<=e;r++)u(g,h,m,k),z+=p,z>=x&&(z-=x,h+=n,m+=v),h+=l,m+=q}k=Math.min(a,f);a=Math.max(a,f);f=Math.min(b,
c);b=Math.max(b,c);0>a-k||0>b-f||d(k,f,a-k+1,b-f+1)};this.drawText=function(a,b,f,c,k,h,g,e,l,q,x,u,p,E,t,w,y,ga,za,Aa,R){var m=0;1<u?n(q,x,u,p,k,ga,za,Aa,R):1==f&&n(h,g,e,l,k,ga,za,Aa,R);for(var v=w,z=0;z<w;)switch(y[m+z]){case 255:var B=y[m+z+2];if(B>v-m){z=w=0;break}B=y.slice?y.slice(m,m+B):y.subarray(m,m+B);F[y[m+z+1]]=B;z+=3;w-=z;m=z;z=0;break;case 254:var aa=(B=F[y[m+z+1]])?B:null;aa&&0==aa[1]&&0==(b&32)&&(0!=(b&4)?t+=y[m+z+2]:E+=y[m+z+2]);z=z+2<w?z+3:z+2;w-=z;m=z;z=0;if(!aa)break;for(var Xa=
aa.length,fa=0;fa<Xa;fa++){B=M.getFont(a,aa[fa]);if(0==(b&32)){var A=aa[++fa];0!=(A&128)?(0!=(b&4)?t+=aa[fa+1]|aa[fa+2]<<8:E+=aa[fa+1]|aa[fa+2]<<8,fa+=2):0!=(b&4)?t+=A:E+=A}B&&(r(f,E+B.offset&65535,t+B.baseLine&65535,B.width,B.height,B.fontData,k,c,ga,za,Aa,R),0!=(b&32)&&(E+=B.width))}break;default:B=M.getFont(a,y[m+z]),0==(b&32)&&(A=y[m+ ++z],0!=(A&128)?(0!=(b&4)?t+=y[m+z+1]|y[m+z+2]<<8:E+=y[m+z+1]|y[m+z+2]<<8,z+=2):0!=(b&4)?t+=A:E+=A),B&&(r(f,E+B.offset&65535,t+B.baseLine&65535,B.width,B.height,
B.fontData,k,c,ga,za,Aa,R),0!=(b&32)&&(E+=B.width)),z++}1<u?0<p&&d(q,x,u,p):0<e&&0<l&&d(h,g,e,l)};this.drawBitmap=function(b,d,f,c,k,h,g,e,r){var m=N.getBitmap(b,d);m?(b=m.width,d=m.height,k>b&&(k=b),h>d&&(h=d),12==r?R.setRGBs(f,c,k,h,m.data,e*b+g,b):R.bitBlt(r,a,f,c,k,h,m.data,b,g,e)):svGlobal.logger.warn("Failed to get bitmap from cache, id:"+b+" idx="+d)};this.saveDesktop=function(a,b,d,f,c){R.getRGBs(a,b,d,f,function(k){Ca.save(a,b,d,f,c,k)})};this.restoreDesktop=function(a,b,d,f,c){(c=Ca.restore(a,
b,d,f,c))?R.setRGBs(a,b,d,f,c,0,d):svGlobal.logger.warn("XXX no matched desktop save.")};this.putFont=function(a,b,d){M.putFont(a,b,d)};this.putBitmap=function(a,b,d){N.putBitmap(a,b,d)};this.putCursor=function(a,b){K.set(a,b)};this.setCursor=function(a){if(!ga&&-1!=a){var b=K.get(a);if(b)R.onSetCursor(b);else svGlobal.logger.warn("invalid cursor"+a)}};var L=0;this.isSendingHistory=function(){return 2E3>Date.now()-L};this.getHistory=function(a,b){var d=null;t&&t.begin("his_bitmap");N.forEach(function(b,
f,c){if(b){var k=0,h=0;c=0;for(var g=b.length;c<g;c++)b[c]&&b[c].data&&(k++,h+=b[c].raw?b[c].raw.length:4*b[c].data.length);if(k&&h){d=new Uint8Array(h+20*k+8);d[0]=29;d[2]=1;d[3]=4;h=new hi5.DataBuffer(d,4,d.length);h.setLittleEndian32(k);for(c=0;c<g;c++)(k=b[c])&&k.data&&(h.setLittleEndian16(f),h.setLittleEndian16(c),h.setLittleEndian16(k.left),h.setLittleEndian16(k.top),h.setLittleEndian16(k.width),h.setLittleEndian16(k.height),h.setLittleEndian16(k.bitsperpixel),h.setLittleEndian16(k.codec),h.setLittleEndian32(k.raw?
k.raw.length:4*k.data.length),h.setBytes(k.raw||new Uint8Array(k.data.buffer)));a(d.buffer)}}});t&&t.end("his_bitmap");t&&t.begin("his_font");(d=M.toPDU())&&a(d.buffer);t&&t.end("his_font");(d=K.toPDU())&&a(d.buffer);for(var f=4,c=0,k=F.length;c<k;c++)F[c]&&(f+=F[c].length+6);if(4<f){d=new Uint8Array(f);d[0]=29;d[2]=1;d[3]=7;for(var h=4,c=0,k=F.length;c<k;c++)F[c]&&F[c].length&&(d[h++]=c,d[h++]=c>>8,f=F[c].length,d[h++]=f,d[h++]=f>>8,d[h++]=f>>16,d[h++]=f>>24,d.set(F[c],h),h+=f);a(d.buffer)}(d=Ca.toPDU())&&
a(d.buffer);b();L=Date.now()};this.setHistory=function(a,b){switch(a){case 4:t&&t.begin("his_bitmap_dec");for(var d=b.getLittleEndian32(),c=0;c<d;c++){var f=b.getLittleEndian16(),k=b.getLittleEndian16(),h=b.getLittleEndian16(),g=b.getLittleEndian16(),e=b.getLittleEndian16(),r=b.getLittleEndian16(),n=b.getLittleEndian16(),l=b.getLittleEndian16();var q=b.getLittleEndian32();var x=new Uint8Array(b.getData().buffer,b.getPosition(),q),u=new Uint8Array(q);u.set(x);var x=rdpcodecs.bitmap;switch(l){case 0:var v=
new Uint32Array(u.buffer);b.skipPosition(q);break;case 1:switch(n){case 16:v=x.decompressInt16(e,r,q,u,0);break;case 24:v=x.decompressInt24(e,r,q,u,0);break;case 32:v=x.decompressInt32(e,r,q,u,0)}b.skipPosition(q);break;case 2:v=new rdpcodecs.NSCodec,v.process(b,n,e,r),q=v.getData(),v=v.getDataSize(),v=new Uint32Array(v),rdpcodecs.flipimage(q,0,v,e,r,1)}N.putBitmap(f,k,new rdpcodecs.Bitmap(v,e,r,h,g,n,0==l?null:u,l))}t&&t.end("his_bitmap_dec");break;case 5:M.fromStream(b);break;case 6:K.fromStream(b);
break;case 7:for(;b.has(6);)if(c=b.getLittleEndian16(),q=b.getLittleEndian32())d=b.getData().subarray(b.getPosition(),b.getPosition()+q),F[c]=d,b.skipPosition(q);break;case 9:Ca.fromStream(b)}};var K=new function(){var a=[];this.set=function(b,d){a[b]=d};this.get=function(b){return a[b]};this.total=function(){return a.length};this.toPDU=function(){for(var b=2,d=2,c=0,f=0,k=a.length,h;f<k;f++)if(h=a[f])c++,d=d+7+(h.rawData?h.rawData.length:0);if(!c)return null;d=new Uint32Array(d);d[0]=100728861;d[1]=
c;for(f=0;f<k;f++)if(h=a[f])if(c=h.rawData?h.rawData.length:0,d[b++]=h.cache_idx|h.bpp<<16,d[b++]=h.hotX|h.hotY<<16,d[b++]=h.width|h.height<<16,d[b++]=h.xorSize,d[b++]=h.andSize,d[b++]=h.distance,d[b++]=c)d.set(h.rawData,b),b+=c;return d};this.fromStream=function(b){var d=b.getPosition();b=new Uint32Array(b.getData().buffer,d);for(var c=b[0],f=0,k,g,e,r,n,q,l,x,u,v,p,d=1;f<c;f++)k=b[d]&65535,g=b[d++]>>16,e=b[d]&65535,r=b[d++]>>16,n=b[d]&65535,q=b[d++]>>16,l=b[d++],x=b[d++],u=b[d++],v=b[d++],p=null,
v&&(p=new Uint32Array(v),p.set(b.subarray(d,d+v)),d+=v),g=new h(k,p,e,r,n,q,g,l,x),u&&(g.distance=u),a[k]=g}},Ca=new function(){function a(a,b,d,c,f,k){this.x=a;this.y=b;this.cx=d;this.cy=c;this.offset=f;this.data=k}var b=[];this.save=function(d,c,f,k,h,g){d=new a(d,c,f,k,h,g);c=0;for(f=b.length;c<f;c++)if(!b[c]){b[c]=d;return}b.push(d)};this.restore=function(a,d,c,f,k){for(var h,g=0,e=b.length;g<e;g++)if((h=b[g])&&h.x==a&&h.y==d&&h.cx==c&&h.cy==f){if(h.offset==k)return a=h.data,b[g]=null,a;svGlobal.logger.warn("TODO: offset")}return null};
this.toPDU=function(){for(var a=0,d=2,c=0,f=b.length;c<f;c++)b[c]&&(a++,d+=b[c].data.length+6);if(!a||!d)return null;var d=new Uint32Array(d),h=2;d[0]=151060509;d[1]=a;for(c=0;c<f;c++)if(a=b[c])d[h++]=a.x,d[h++]=a.y,d[h++]=a.cx,d[h++]=a.cy,d[h++]=a.offset,d[h++]=a.data.length,d.set(a.data,h),h+=a.data.length;return d};this.fromStream=function(a){a=new Uint32Array(a.getData().buffer,a.getPosition());for(var b=1,d=a[0],c,f,h,k,g,e,r,n=0;n<d;n++)c=a[b++],f=a[b++],h=a[b++],k=a[b++],g=a[b++],e=a[b++],
r=new Uint32Array(e),e=b+e,r.set(a.subarray(b,e)),b=e,this.save(c,f,h,k,g,r)}},F=[],M=new function(){var a=[];this.putFont=function(b,d,c){a[b]||(a[b]=[]);a[b][d]=c};this.getFont=function(b,d){return a[b]?a[b][d]:null};this.toPDU=function(){var b=0,d,c,f;var h=4;for(var k,g=a.length;b<g;b++)if((f=a[b])&&f.length)for(k=f.length,d=0;d<k;d++)(c=f[d])&&(h+=15+c.fontData.length);if(5>h)return null;var e=new Uint8Array(h);h=new hi5.DataBuffer(e,0,h);e[0]=29;e[2]=1;e[3]=5;h.skipPosition(4);b=0;for(g=a.length;b<
g;b++)if((f=a[b])&&f.length)for(k=f.length,d=0;d<k;d++)if(c=f[d])h.setByte(b),h.setLittleEndian16(d),h.setLittleEndian16(c.offset),h.setLittleEndian16(c.baseLine),h.setLittleEndian16(c.width),h.setLittleEndian16(c.height),h.setLittleEndian32(c.fontData.length),h.setBytes(c.fontData);return e};this.fromStream=function(a){for(;a.has(15);){var b=a.getByte(),d=a.getLittleEndian16(),c=a.getLittleEndian16(),f=a.getLittleEndian16(),h=a.getLittleEndian16(),k=a.getLittleEndian16(),g=a.getLittleEndian32(),
g=a.getBytes(g);this.putFont(b,d,new E(c,f,h,k,g))}}},N=new function(){var a=[],b=[];this.putBitmap=function(d,c,f){if(32767==c)b[d]&&(b[d].data=null,b[d]=null),b[d]=f;else{var h=a[d];h?h[c]&&(h[c].data=null,h[c]=null):a[d]=h=[];h[c]=f}};this.getBitmap=function(d,c){return 32767==c?b[d]:a[d]?a[d][c]:null};this.forEach=function(b){for(var d=a.length,c=0;c<d;c++)b(a[c],c,a)}}}this.displayMsg=this.reconnectOnResize=!0;this.appTimeout=1600;this.reconnectTimes=0;this.windowState=3;this.setTitle=this.openLink=
!0;this.audioBuffer=0;this.sessionInfo={domain:"",userName:"",sessionId:0,joinedSessions:[],suppressOutput:!1,appInfo:null};this.mode=0;this.remoteAppLogin=!0;var Ba=!1,ha={},ia={},ua=null,e=this,Ta=!1,V=!1,Z=0,va=null,wa=null,t=hi5.appcfg||{img:{},toolbar:{fadable:!0}};this.setConfig=function(a){t=a};var ca="object"==typeof p?p:null,l=ca?{}:hi5.tool.queryToObj(p.substring(p.indexOf("?")+1)),I=0,G=0,na=(M||l.color||l.server_bpp||16)|0,pa=null,yb=null,P=null,Oa=hi5.browser.isIE||hi5.browser.isEdge;
this.protocol=ca?"":p.substring(0,p.indexOf("://")).toLowerCase();this.setProfiler=function(a){yb=a};this.getProfiler=function(){return yb};this.gateway=function(){if(ca)return"";var a=p.lastIndexOf("/RDP?");-1==a&&(a=p.lastIndexOf("/JOIN?"));-1==a&&(a=p.lastIndexOf("/PLAY?"));return p.substring(0,a).replace(/wss\:\/\//ig,"https://").replace(/ws\:\/\//ig,"http://")}();svGlobal.logger.warn("Ver:"+svGlobal.version+" build:"+svGlobal.build);this.getGatewayAddr=qa;var ka="object"==typeof p||0<p.indexOf("/PLAY?"),
zb=!ka&&0<p.indexOf("invitation=");if(zb){var Ya=decodeURIComponent(p),xa=Ya.indexOf(' USERNAME="');if(0<xa){var xa=xa+11,Ab=Ya.substring(xa,Ya.indexOf('"',xa));p+="&novice="+Ab+"&server="+Ab}p+="&mapClipboard=on";l.mapClipboard="on"}if(ka)this.mode=1,ca?p="":(I=640,G=480),p+="&touchpad=on",l.touchpad="on",this.reconnectOnResize=!1;else if(0<p.indexOf("/JOIN?")||zb)this.mode=2,this.reconnectOnResize=!1;C?I=parseInt(C):l.width&&(I=parseInt(l.width));J?G=parseInt(J):l.height&&(G=parseInt(l.height));
-1==I&&(I=hi5.browser.getScreenWidth());-1==G&&(G=hi5.browser.getScreenHeight());l.symlink&&l.parameters&&hi5.tool.queryToObj(l.parameters,l);l.gateway||(p+="&gateway="+encodeURIComponent(e.gateway));!l.minWidth&&t.minWidth&&(rdArgs.minWidth=t.minWidth);!l.minHeight&&t.minHeight&&(rdArgs.minHeight=t.minHeight);l.minWidth&&(l.minWidth=parseInt(l.minWidth));l.minHeight&&(l.minHeight=parseInt(l.minHeight));l.waWidth=l.waWidth?parseInt(l.waWidth):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,
screen.height):screen.width;l.waWidth&=-4;l.waHeight=l.waHeight?parseInt(l.waHeight):hi5.browser.isAndroid||hi5.browser.isiOS?Math.max(screen.width,screen.height):screen.height;l.waHeight&=-4;"useSSL"in l||(p+="&useSSL="+("wss"==e.protocol));hi5.storage.isAvailable&&(X(l.shareClipboard)||l.shareClipboardId)&&(p+="&shareClipboardId="+(l.shareClipboardId||Bb()));t&&(void 0!=t.displayMsg?this.displayMsg=t.displayMsg:t.displayMsg=this.displayMsg,t.appTimeout&&(this.appTimeout=t.appTimeout),void 0!=t.reconnectOnResize&&
(this.reconnectOnResize=t.reconnectOnResize),t.reconnectTimes&&(this.reconnectTimes=t.reconnectTimes),void 0!=t.windowState&&(this.windowState=t.windowState),void 0!=t.openLink&&(this.openLink=t.openLink),void 0!=t.setTitle&&(this.setTitle=t.setTitle),t.audioBuffer&&(this.audioBuffer=t.audioBuffer),"boolean"==typeof t.useWSS&&(p=(t.useWSS?"wss":"ws")+p.substring(p.indexOf("://"))),"boolean"==typeof t.remoteAppLogin&&(this.remoteAppLogin=t.remoteAppLogin,Ba=!t.remoteAppLogin,svGlobal.logger.warn("remoteAppLogin deprecated, use hideLogin in appcfg.js instead")),
"boolean"==typeof t.hideLogin&&(Ba=t.hideLogin));X(l.nocurosr);var U="app"==l.startProgram,Ua=X(l.mapDisk),O=null;U&&(this.reconnectOnResize=!1);void 0==t.useWorker&&(t.useWorker=!1);t.useWorker&&(!window.Worker||hi5.browser.isFirefox||U&&!Oa||"file:"==location.protocol||0<navigator.userAgent.indexOf("MSIE 10."))&&(t.useWorker=!1);void 0==hi5.libMin&&(hi5.libMin=!0);var K=t.useWorker?new Worker(hi5.libPath+(t.rdpworker||(hi5.libMin?"rdpworker_min.js":"rdpworker.js"))):null,oa=this.reconnectTimes,
Ja=K?{type:5,data:null}:null;this.getDisplayName=ra;this.server=ra();this.port=parseInt(l.port,10);this.loadbalanceToken=t.loadbalanceTokenName?t.loadbalanceTokenName+"="+hi5.tool.uuid():"";this.modifyURL=function(a){e.loadbalanceToken&&(a+=-1==a.indexOf("?")?"?"+e.loadbalanceToken:"&"+e.loadbalanceToken);return a};this.getURL=function(){return p};this.getColor=function(){return na};this.changeTitle=Ea;hi5.browser.isTouch&&Math.max(I,G)>Math.max(window.innerWidth,window.innerHeight)&&(this.reconnectOnResize=
!1);this.isRemoteApp=function(){return U};var D=null,L=!1,ma=!1,Wa=!1,F=new function(a){var b=null;this.available=!1;this.delay=a;this.supportWebAudio=!1;if(0==l.playSound||0<e.mode)if(b=hi5.audio.getAudioContext())this.supportWebAudio=this.available=!0;this.getContext=function(){return b};this.getBuffer=function(a){return b.createBuffer(2,a,ea)};var c=0,g=null,d=null;this.setVolume=function(a){1==a?g=null:(g||(g=b.createGain()),g.gain.value=a)};this.playBuffer=function(f){d=b.createBufferSource();
d.buffer=f;g?(d.connect(g),g.connect(b.destination)):d.connect(b.destination);var k=b.currentTime,e=0<c?c:k+a;e<k&&(e=k);c=e+f.duration;d.start?d.start(e):d.noteOn(e);return c-k};this.iOSFix=function(){if(b&&hi5.browser.isTouch&&hi5.browser.isSafari){var a=this.getBuffer(1024),d=b.createBufferSource();d.buffer=a;d.connect(b.destination);d.start?d.start(0):d.noteOn(0)}};this.close=function(){b&&(g&&g.disconnect(),d&&d.disconnect(),hi5.audio.releaseAudioContext())}}(e.audioBuffer),mb=F.available,y=
new ab(200,200);y.onSetCursor=nb;this.setVolume=function(a){F&&F.setVolume(a)};this.setAudioBuffer=function(a){e.audioBuffer=a;F.delay=a};var Ga=0,Fa=0,Ha=I-1,Ia=G-1,wb="";window.$rdp=this;sa(na);this.running=function(){return L};this.setJoinMode=function(a){L&&A("8E1"+a)};this.setJoinCloseMode=function(a){L&&A("8EB3\t"+a)};this.refuseControl=function(a){L&&A("8E3"+a)};this.giveControl=function(a){L&&A("8E4"+a)};this.pauseSession=function(a,b){L&&A("8EB"+(b?1:0)+"\t"+a)};this.closeSession=function(a){L&&
A("8EB2\t"+a)};this.requestControl=function(){L&&A("8E2")};this.saveSession=function(a){L&&A("8E9"+(a.save?1:0)+"\t"+(a.timeout||0)+"\t"+(a.id||0))};this.allowJoin=function(a,b){L&&A("8EA"+a+"\t"+(b?1:0))};var Da=new function(){function a(){if(c&&0<c.length){var b=c.shift();b.key?Da.sendSingleKey(b.down,b.key):b["char"]&&cb(b["char"]);0<c.length?setTimeout(a,g):(c=null,d&&d())}}var b={" ":57,space:57,pgup:201,pageup:201,pgdn:209,pagedown:209,end:207,home:199,left:203,up:200,right:205,down:208,printscreen:183,
insert:210,del:211,"delete":211,altgr:184,windows:219,windowsright:220,context:221,esc:1,backspace:14,back:14,tab:15,enter:28,meta:29,command:29,ctrl:29,shift:42,alt:56,capslock:58,f1:59,f2:60,f3:61,f4:62,f5:63,f6:64,f7:65,f8:66,f9:67,f10:68,f11:87,f12:88,numlock:69,scrolllock:70,add:78};this.sendSingleKey=function(a,d){var c=b[d.toLowerCase()];c?e.writeScancode(a,c):(c=d.length,0!=c&&(1==c?e.writeKeyCode(a,d.toUpperCase().charCodeAt(0)):a&&e.writeText(d)))};var c=null,g=0,d=null;this.sendKeyComb=
function(b,k,e){if(V){b=b.split("+");var f=b.length,n;if(0!=f){var r=null,l=[];for(n=0;n<f;n++){var h=b[n];""==h&&""==r&&(h="Add");""!=h&&l.push({key:h,down:!0});r=h}f=l.length;for(n=f-1;0<=n;n--)l.push({key:l[n].key,down:!1});if(k)c=l,g=k,d=e,a();else for(n=0,f=l.length;n<f;n++)Da.sendSingleKey(l[n].down,l[n].key)}}};this.sendText=function(b,k,e){for(var f=[],n=0,r=b.length;n<r;n++)f.push({"char":b.charAt(n)});c=f;g=k;d=e;a()}};this.writeKeyComb=function(a,b,c){V&&Da.sendKeyComb(a,b,c)};this.writeText=
function(a,b,c){if(V)if(b)Da.sendText(a,b,c);else for(b=0,c=a.length;b<c;b++)cb(a.charAt(b))};this.writeClipboard=function(a,b){a&&(b||(b="text/plain"),e.writeRawInput("880"+b+"\t"+a.hashCode()),wa={type:b,text:a})};var w=new function(a,b){function c(){function b(a){for(;0<a.ownerWinid;){var b=n.getWinById(a.ownerWinid);if(b&&b.isVisible())a=b;else break}return a}function c(a){for(var b="";a;)a.titleInfo&&(b=a.titleInfo),a=n.getWinById(a.ownerWinid);return b}var k=[],g=[],e=0,n=this;this.mainWin=
null;this.appId="";this.onchange=function(b){b.isVisible()||b!=n.mainWin?b.isVisible()&&!n.mainWin&&b.isMainWin()&&(n.mainWin=b,a.windowState&&b.exeCommand(61488)):n.mainWin=null};this.addWin=function(b){for(var d=k.length,c=!1,f=0;f<d;f++)if(b.id==k[f].id){k[f]=b;c=!0;break}c||k.push(b);1==k.length&&(e=Date.now());0<a.windowState&&(d=b.isMainWin(),svGlobal.logger.info("is main win:"+d+" id:"+b.id),d&&!n.mainWin&&(n.mainWin=b))};this.popWins=function(a){a=n.getWinById(a);var b=[];if(a){a=0<a.ownerWinid?
a.ownerWinid:a.id;for(var d=k.length-1;0<=d;d--)if(k[d].ownerWinid==a||k[d].id==a)b.push(k[d]),k.splice(d,1)}return b};this.hasApp=function(a){return-1!=g.indexOf(a)};this.addApp=function(a){return-1==g.indexOf(a)?(g.push(a),!0):!1};this.isNew=function(){return 3E4>Date.now()-e};this.getAll=function(){return k};this.hasWin=function(a){return 0<=k.indexOf(a)};this.close=function(){for(var a=0,b=k.length;a<b;a++)k[a].close()};this.clear=function(){k.length=0};this.delWin=function(a){for(var b=0,d=k.length;b<
d;b++)if(k[b].id==a)return k.splice(b,1),b;return-1};this.isRunning=function(){var a=k.length;if(1>a)return!1;for(var b=0,a=k.length;b<a;b++){var d=k[b];if(d.showState)return!0}return!1};this.getWinById=function(a){var b=k.length;if(1>b)return null;for(var d=0;d<b;d++){var c=k[d];if(c.id==a)return c}return null};this.getMainWinByAppId=function(a){var b=null,d=0;for(len=k.length;d<len;){b=k[d];if(b.appId==a&&b.isVisible()&&1>b.ownerWinid)break;d++}return b};this.getTopWin=function(a){var b=null,d,
c=a.length;for(d=0;d<c&&(!(b=n.getWinById(a[d]))||!b.isVisible());d++)b=null;if(!b)for(svGlobal.logger.warn("No win found"),c=k.length,d=c-1;0<=d&&(b=k[d],!b.isVisible());d--)b=null;return b};this.getMain=function(a){return(a=n.getTopWin(a))?b(a):null};this.getOtherApps=function(a,d,f){var h=k.length;if(0!=h&&k[h-1])if(h=k[h-1].appId,f||!h)setTimeout(function(){n.getOtherApps(a,d)},f||3E3);else{f=[];if(h=n.getTopWin(a)){for(var g=0<h.ownerWinid?h.ownerWinid:h.id,e=[],l=0,h=k.length;l<h;l++)k[l].ownerWinid!=
g&&k[l].id!=g&&k[l].isVisible()&&e.push(k[l]);l=0;for(h=e.length;l<h;l++)e[l].ownerWinid!=g&&e[l].id!=g&&(f.push({title:c(e[l]),win:b(e[l])}),g=0<e[l].ownerWinid?e[l].ownerWinid:e[l].id)}d(f)}};this.getFullTitle=function(a){for(var b,d="";;){b=n.getWinById(a);if(!b)break;b.titleInfo&&b.isVisible()&&(d&&(d=" > "+d),d=b.titleInfo+d);if(1>a)break;a=b.ownerWinid}return d}}var g=[];a.isRemoteApp();this.verifyMonitors=function(){var a=g[0].getMousePosition(),b,c=g.length;g[0].configMonitor();for(b=1;b<
c;b++){g[b].configMonitor();var e=g[b].getMousePosition();Math.abs(e.left)+Math.abs(e.top)<Math.abs(a.left)+Math.abs(a.top)&&(a=e)}0!=a.left&&(a.right-=a.left,a.left=0);0!=a.top&&(a.bottom-=a.top,a.top=0);for(b=0;b<c;b++)if(e=g[b].getMousePosition(),e!=a){if(0>e.right){var l=-e.right-1;0<l&&(e.left+=l,e.right+=l)}e.left>a.right&&(l=e.left-a.right-1,0<l&&(e.left-=l,e.right-=l));0>e.bottom&&(l=-e.bottom-1,0<l&&(e.top+=l,e.bottom+=l));e.top>a.bottom&&(l=e.top-a.bottom-1,0<l&&(e.top-=l,e.bottom-=l))}};
this.repaint=function(a,b,c,e){for(var d=0,f=g.length;d<f;d++)g[d].repaint(a,b,c,e)};this.size=function(){return g.length};this.getSurface=function(a){return g[a]};this.addSurface=function(a){g.push(a)};this.hasSurface=function(a){for(var b=g.length,d=0;d<b;d++)if(g[d].equals(a))return!0;return!1};this.fromSyncedSurface=function(a){var b=g.length;Date.now();for(var d=0;d<b;d++)if(g[d].isClipSynced(a))return!0;return!1};this.setSize=function(a,b,c){for(var d=0,f=g.length;d<f;d++)g[d].setSize(a,b,c)};
this.zOrders=[];this.drawLicense=function(a){for(var b=0,d=g.length;b<d;b++)g[b].drawLicense(a)};this.setReadOnly=function(a,b){for(var d=0,c=g.length;d<c;d++)g[d].setReadOnly(a,b)};this.setVisible=function(a,b){svGlobal.logger.info("TODO: setVisible")};this.copyToClip=function(a){1>g.length||g[0].copyToClip(a)};this.setCursor=function(a){for(var b=0,d=g.length;b<d;b++)g[b].setCursor(a)};this.hide=function(a){a=0;for(var b=g.length;a<b;a++)g[a].hide()};this.execute=function(a,b){for(var d=0,c=g.length;d<
c;d++)g[d][a].apply(g[d],b)};this.addWin=function(d){var f=this.getFocused();f||(svGlobal.logger.warn("Focused surface not found!"),f=g[g.length-1]);f?(f.railWin||(f.railWin=new c,f.onunload=function(){hi5.appcfg.closeRemoteApp&&f.railWin&&f.railWin.close();f.remoteApp&&f.remoteApp.close();f.railWin&&(f.railWin.clear(),f.railWin=null);g.removeElm(f)}),f.context&&b.setContext(f.context),f.railWin.addWin(d),a.windowState&&f.railWin.mainWin==d&&setTimeout(function(){var b=f.getFreeSpace();a.writeRawInput("8C661441\t"+
b.width+"\t"+b.height);svGlobal.logger.info("-- main win dp change:"+b.height);setTimeout(function(){d.exeCommand(61488);svGlobal.logger.info("-- max")},50)},111),Oa&&f.focus()):svGlobal.logger.warn("No surface available!")};this.delWin=function(b){for(var d,c=g.length-1;0<=c;c--){var e=g[c];d=e.railWin;var l=d.getWinById(b),n=l&&l.appId&&-1!=l.appId.toLowerCase().indexOf("runonce");if(0<=d.delWin(b)){l==d.mainWin&&(d.mainWin=null);if(e.toolbar){b="win"+b;var r=e.toolbar.querySelector("#"+b);r&&e.toolbar.removeChild(r)}if(d.isRunning())null==
d.mainWin&&(e=d.getMain(w.zOrders))&&(d.mainWin=e,a.windowState&&e.exeCommand(61488));else{if(l.isMainWin()&&e.onremoteappclose)e.onremoteappclose(l);l=a.appTimeout;if(n||d.isNew())l*=10;svGlobal.logger.debug("Prepare del:"+Date.now());setTimeout(function(a){return function(){svGlobal.logger.info("Start del:"+Date.now());a.railWin&&a.railWin.isRunning()||(a.remoteApp&&a.remoteApp.close(),w&&w.delSurface(a))}}(e),l)}}}};this.popWins=function(a){return g[0]&&g[0].railWin?g[0].railWin.popWins(a):[]};
this.getWinById=function(a){for(var b,d=0,c=g.length;d<c;d++)if(g[d].railWin&&(b=g[d].railWin.getWinById(a)))return b;return null};this.getMainWinByAppId=function(a){for(var b,d=0,c=g.length;d<c;d++)if(g[d].railWin&&(b=g[d].railWin.getMainWinByAppId(a)))return b;return null};this.onWinChange=function(a){for(var b,d=0,c=g.length;d<c;d++)if(g[d].railWin&&(b=g[d].railWin.getWinById(a.id)))g[d].railWin.onchange(a)};this.setTitle=function(b){for(var d,c=0,e=g.length;c<e;c++)if(g[c].railWin){d=g[c].railWin.getWinById(b);
var l=g[c].railWin.getFullTitle(b);if(l){a.changeTitle(l,g[c].getWindow(),d.appId);break}}};this.hasApp=function(a){for(var b=0,d=g.length;b<d;b++)if(g[b].railWin.hasApp(a))return!0;return!1};this.delSurface=function(b){!b||b.railWin&&b.railWin.isRunning()||(svGlobal.logger.info("delete surface..."),g.removeElm(b),b.close(),0==g.length&&a._unload())};this.getOwnerSurface=function(a){for(var b=0,d=g.length;b<d;b++)if(g[b].railWin&&g[b].railWin.hasWin(a))return g[b];return null};this.getFocused=function(){for(var a=
g.length,b=0;b<a;b++)if(g[b].focused)return g[b];return g[a-1]};this.close=function(){for(var a=0,b=g.length;a<b;a++)g[a]&&(g[a].remoteApp&&g[a].remoteApp.close(),g[a].close(),g[a]=null)};this.LocalWin=function(b){function d(){a.writeRawInput("8C0"+b)}this.id=b;this.appId="";var c=this;this.resizable=function(){return 0!=(c.style&262144)||0!=(c.style&65536)||0!=(c.style&16777216)||3==c.showState};this.setShowState=function(a){c.showState=a};this.parent=function(){return w.getWinById(c.ownerWinid)};
this.resize=function(b,d,f,e){hi5.appcfg.disableJoinedAppResize&&2==a.mode||a.writeRawInput("8C1"+c.id+"\t"+b+"\t"+d+"\t"+f+"\t"+e)};this.exeCommand=function(d){a.writeRawInput("8C4"+b+"\t"+d)};this.activate=function(d){2==c.showState?(c.exeCommand(61728),setTimeout(function(){a.writeRawInput("8C3"+b+"\t"+d)},50)):a.writeRawInput("8C3"+b+"\t"+d)};this.close=function(){c.exeCommand(61536)};this.getAppId=d;this.isVisible=function(){return c.winWidth&&c.winHeight&&c.showState&&45<c.winHeight&&45<c.winWidth};
this.isMainWin=function(){if(!(c.winWidth&&c.winHeight&&45<c.winHeight&&45<c.winWidth))return!1;var a=1>c.ownerWinid;if(!a)return a;var b=c.style;if(0!=(b&4194304))return!0;if(0!=(b&2147483648)&&(0==(b&8388608)||0==(b&12582912)))return!1;var d=0!=(c.extStyle&128);(a=a&&!d)&&0!=(b&2147483648)&&0==(b&2156396544)&&(a=!1);return a};d()}}(e,y);this.getSurfaces=function(){return w};this.hide=function(){w&&w.hide()};this.getFileUrl=function(a){return e.modifyURL(qa()+"/DOWNLOAD?s="+wb+"&f="+a)};this.listFiles=
function(a,b){O&&V&&O.list(a,b)};this.writeRawInput=function(a){if(V){A(a);if(e.onactivity)e.onactivity(a);return!0}return!1};var T=new function(a,b,c){this.setJoinMode=a.setJoinMode;this.requestControl=a.requestControl;this.writeKeyComb=a.writeKeyComb;this.writeText=a.writeText;this.remoteLockFlags=this.localLockFlags=0;this.checkLockFlags=!0;this.reqCopyTime=0;this.draw=c.draw;var g=a.isRemoteApp();this.refresh=function(a,b,d,e){return c.repaint(a,b,d-a+1,e-b+1)};this.getAppMode=function(){return a.mode};
this.send=a.writeRawInput;this.saveSession=function(b){a.saveSession(b)};this.sendInput=a.writeRawInput;var d=null;this.getAppInfo=function(){return a.sessionInfo.appInfo};this.onresize=function(c){if(c=c.target.svSurface){var f=c.getFreeSpace(),e=f.width,l=f.height;if(g){var n=0;(c=c.railWin.getTopWin(b.zOrders))&&c._hOffset&&(n=c._hOffset);d&&(clearTimeout(d),d=0);d=setTimeout(function(){a.writeRawInput("8C661441\t"+e+"\t"+(l-n));svGlobal.logger.info("-- displayChange, h:"+l+" off:"+n)},333);svGlobal.logger.info("-- resize, off:"+
n)}else a.reconnectOnResize&&a.running()&&(d&&(clearTimeout(d),d=0),d=setTimeout(function(){a.reconnect(e,l)},555))}};this.onorientationchange=function(b){a.reconnectOnResize?a.reconnect(b.innerWidth,b.innerHeight):g&&b.svSurface&&a.windowState&&a.writeRawInput("8C661441\t"+b.innerWidth+"\t"+b.innerHeight)};this.getClipData=function(b,d){this.reqCopyTime=Date.now();var c=hi5.httpGet(a.modifyURL(a.getGatewayAddr()+"/CLIP?s="+a.sessionInfo.appInfo.session+"&t="+Date.now()+"&type="+b),d);this.reqCopyTime=
Date.now();return c};this.onfocus=function(d){var f=d.target;g&&f.svSurface&&f.svSurface.railWin&&(d=f.svSurface.railWin.getTopWin(b.zOrders))&&a.running()&&(f=f.svSurface.context)&&f!=c.getContext()&&(c.setContext(null),d.activate(1),svGlobal.logger.info("Activate win:"+d.id))};this.getShareFiles=a.listFiles;this.getFile=function(b){a.reconnectOnResize=!1;var d=a.getFileUrl(b);e.ondownload&&e.ondownload({fileName:b,url:d})||window.open(d)};this.getFileLink=a.getFileUrl;this.getGateway=function(){return p};
this.reconnect=function(b,d,c){l.symlink?(b="user="+b+"&pwd="+d,c&&(b+="&domain="+c),p=hi5.tool.replaceQuery(p,"parameters",b)):(p=hi5.tool.replaceQuery(p,"user",b),p=hi5.tool.replaceQuery(p,"pwd",d),p=hi5.tool.replaceQuery(p,"domain",c));a.run()};this.sendKeyboardSyncFlags=function(b){return a.writeRawInput("8E5"+b)?(this.remoteLockFlags=this.localLockFlags=b,!0):!1};this.sendKeyboardSynchronize=function(a,b,d){var c=0;d&&(c|=4);b&&(c|=2);a&&(c|=1);this.sendKeyboardSyncFlags(c)};this.fromSyncedSurface=
function(a){return b.fromSyncedSurface(a)}}(e,w,y);this.sendKeyboardSynchronize=function(a,b,c){T.sendKeyboardSynchronize(a,b,c)};var N=null,H={count:0,names:[],close:function(){for(var a=H.names,b=0,c=a.length;b<c;b++)H[a[b]].onclose&&(H[a[b]].onclose(),H[a[b]]=null);a.length=0},init:function(a,b,c,g){function d(){this.WAVE_FORMAT_PCM=1;this.WAVE_FORMAT_ADPCM=2;this.WAVE_FORMAT_ALAW=6;this.WAVE_FORMAT_MULAW=7;this.WAVE_FORMAT_GSM=49;this.WAVE_FORMAT_MPEGLAYER3=85;this.WAVE_FORMAT_AAC=41222;this.bitsPerSample=
this.nBlockAlign=this.nAvgBytesPerSec=this.nSamplesPerSec=this.nChannels=this.formatTag=0;this.hasLocalSupport=!1;this.cbSize=0;this.extenstion=null;var a=this;this.fromBuffer=function(b){a.formatTag=b.getLittleEndian16();a.nChannels=b.getLittleEndian16();a.nSamplesPerSec=b.getLittleEndian32();a.nAvgBytesPerSec=b.getLittleEndian32();a.nBlockAlign=b.getLittleEndian16();a.bitsPerSample=b.getLittleEndian16();var d=b.getLittleEndian16();a.cbSize=d;0<d&&(a.extenstion=Array(d),b.copyToByteArray(a.extenstion,
0,b.getPosition(),d),b.skipPosition(d))};this.toBuffer=function(b){b.setLittleEndian16(a.formatTag);b.setLittleEndian16(a.nChannels);b.setLittleEndian32(a.nSamplesPerSec);b.setLittleEndian32(a.nAvgBytesPerSec);b.setLittleEndian16(a.nBlockAlign);b.setLittleEndian16(a.bitsPerSample);b.setLittleEndian16(a.cbSize);0<a.cbSize&&b.setBytes(a.extenstion)};this.getSize=function(){return 18+a.cbSize};this.toString=function(){return"Audio Format, tag="+a.formatTag+" nChannels="+a.nChannels+" nSamplesPerSec="+
a.nSamplesPerSec+" nAvgBytesPerSec"+a.nAvgBytesPerSec+" nBlockAlign"+a.nBlockAlign+" bitsPerSample"+a.bitsPerSample+" cbSize="+a.cbSize}}function f(){N=new e.DynamicChannel;N.name="Microsoft::Windows::RDS::DisplayControl";N.enabled=!1;N.process=function(a){var b=a.getLittleEndian32();a.getLittleEndian32();switch(b){case 5:b=a.getLittleEndian32(),N.maxMonitorAreaFactorA=a.getLittleEndian32(),N.maxMonitorAreaFactorB=a.getLittleEndian32(),N.enabled=!0,svGlobal.logger.warn("Display control maxNumMonitors:"+
b+" factorA:"+N.maxMonitorAreaFactorA+" factorB:"+N.maxMonitorAreaFactorB),a=new Uint8Array(2),a[0]=146,a[1]=4,A(a.buffer),P&&setTimeout(function(){P.check(5E3)},1900)}};N.applyResolution=function(a,b){if(N.enabled){var d=new Uint8Array(56),c=new RdpBuffer(d,0,56);a=a>N.maxMonitorAreaFactorA?N.maxMonitorAreaFactorA:a&-4;b=b>N.maxMonitorAreaFactorB?N.maxMonitorAreaFactorB:b&-4;c.setLittleEndian32(2);c.setLittleEndian32(56);c.setLittleEndian32(40);c.setLittleEndian32(1);c.setLittleEndian32(1);c.setLittleEndian32(0);
c.setLittleEndian32(0);c.setLittleEndian32(a);c.setLittleEndian32(b);c.setLittleEndian32(.26458*a|0);c.setLittleEndian32(.26458*b|0);c.setLittleEndian32(a>b?0:90);c.setLittleEndian32(100);c.setLittleEndian32(100);N.send(d);svGlobal.logger.warn("Display control: "+a+"x"+b)}else svGlobal.logger.warn("Display control disabled.")};return N}if(!t.disableDVC){H.count=0;H.names.length=0;if(t.enableEcho){var k=new e.DynamicChannel;k.name="ECHO";k.process=function(a){var b=a.getPosition(),d=a.getEnd(),c=new Uint8Array(d-
b);c.set(a.getData().subarray(b,d));k.send(c)};e.addDynamicChannel(k)}if(a){var l=new e.DynamicChannel;l.name="Microsoft::Windows::RDS::Input";l.process=function(a){var b=a.getLittleEndian16();a.getLittleEndian32();switch(b){case 1:a.skipPosition(4),a=new RdpBuffer(new Uint8Array(16),0,16),a.setLittleEndian16(2),a.setLittleEndian32(16),a.setLittleEndian32(3),a.setLittleEndian32(65536),a.setLittleEndian16(256),a.markEnd(),l.send(a);case 5:w.execute("setTouchRemoting",[!0]);H.isTouchReady=!0;svGlobal.logger.info("Touch remoting start");
break;case 4:w.execute("setTouchRemoting",[!1]),H.isTouchReady=!1,svGlobal.logger.info("Touch remoting suspend")}};e.addDynamicChannel(l)}if(c){svGlobal.logger.warn("Audio input on");var p=new e.DynamicChannel;(function(){function a(a){var b=new RdpBuffer(new Uint8Array(5),0,5);b.setByte(7);b.setLittleEndian32(a);b.markEnd();p.send(b)}function b(b){b.getLittleEndian32();var h=b.getLittleEndian32();(new d).fromBuffer(b);g=!0;k=e.reconnectOnResize;e.reconnectOnResize=!1;t.onopen||(t.onopen=function(b){if(L){c=
b;e.reconnectOnResize=k;a(h);var d=new RdpBuffer(new Uint8Array(5),0,5);d.setByte(4);d.setLittleEndian32(b?0:1);d.markEnd();p.send(d)}});t.ondata||(t.ondata=function(a,b){c&&(l.length!=b+1&&(l=new Uint8Array(b+1),l[0]=6),p.send(f),l.set(a,1),p.send(l))});t.start()}p.name="AUDIO_INPUT";p.process=function(c){var e=c.getByte();switch(e){case 1:var h=c.getLittleEndian32(),e=new RdpBuffer(new Uint8Array(5),0,5);e.setByte(1);e.setLittleEndian32(h);e.markEnd();p.send(e);break;case 2:var k=c.getLittleEndian32();
c.getLittleEndian32();for(var e=[],l=[],q=F.getContext().sampleRate,h=0;h<k;h++){var n=new d;n.fromBuffer(c);49==n.formatTag&&22050==n.nSamplesPerSec?(n.hasLocalSupport=!0,e.push(n)):1==n.formatTag&&n.nSamplesPerSec==q&&2==n.nChannels&&l.push(n)}p.send(f);k=0;c=e.length;0==c&&(e=l,c=l.length,t.directInput=!0);for(h=0;h<c;h++)k+=e[h].getSize();l=new RdpBuffer(new Uint8Array(1024),0,1024);l.setByte(2);l.setLittleEndian32(c);l.setLittleEndian32(k+9);for(h=0;h<c;h++)e[h].toBuffer(l);l.skipPosition(1024-
k-9);l.markEnd();p.send(l);break;case 3:b(c);break;case 7:e=c.getLittleEndian32();g||(a(e),g=!1);break;default:svGlobal.logger.warn("audioInpt: invalid tag:"+e)}};var c=!1;p.onclose=function(){c=!1;t&&t.close()};var f=new Uint8Array(1);f[0]=5;var g=!1,k=e.reconnectOnResize,l=new Uint8Array(0),u=null,t=new function(a){function b(b){q=!0;if(k.onopen)k.onopen(!0);u=new MSGSMEncoder;f=b;h=a.createMediaStreamSource(b);b=k.directInput?1024:4096;g=a.createJavaScriptNode?a.createJavaScriptNode(b,1,1):a.createScriptProcessor(b,
1,1);k.directInput&&!p&&(p=new Int16Array(2048));g.onaudioprocess=function(a){if(e){a=a.inputBuffer.getChannelData(0);if(k.directInput){for(var b=0,d,c=0;1024>c;c++)d=32767*a[c],p[b++]=d,p[b++]=d;t.ondata(new Uint8Array(p.buffer),4196)}else r.addData(a,l);a.fill(0)}};h.connect(g);g.connect(a.destination)}function d(a){e=q=!1;if(k.onopen)k.onopen(!1);svGlobal.logger.warn("Error on getUserMedia: "+a)}function c(){e||(f&&f.getTracks&&f.getTracks()[0].stop(),g&&g.disconnect(),h&&h.disconnect(),q=!1)}
var e=!1,f=null,h=null,g=null,k=this,l=a.sampleRate/22050,q=!1,n=0;this.directInput=!1;var k=this,p;this.start=function(){n&&clearTimeout(n);if(!q)navigator.getUserMedia?navigator.getUserMedia({audio:!0},b,d):navigator.mediaDevices.getUserMedia({audio:!0}).then(b)["catch"](d);else if(k.onopen)k.onopen(!0);e=!0};this.stop=function(){e=!1};this.close=function(){e=!1;r&&r.reset();u=new MSGSMEncoder;n=setTimeout(c,3E5)};var r=new function(){function a(a){for(var g=c/160|0,l=0;l<g;l++){var q=u.encode(a,
d,h,e);e+=q;e==f&&(e=0,k.ondata(h,f));d+=160;c-=160}b=0<c?a:null}var b=null,d=0,c=0,e=0,f=65*Math.floor(Math.floor(Math.floor(4096/l)/160)/2),h=new Uint8Array(f);this.reset=function(){c=d=e=0;b=null};this.addData=function(e,f){var h=e;if(1==f)e=h;else if(1>f)console.error("rate must be smaller than the original rate"),e=void 0;else{for(var g=new Float32Array(Math.round(h.length/f)),k=0,l=0;k<g.length;){for(var q=Math.round((k+1)*f),m=0,n=0;l<q&&l<h.length;l++)m+=h[l],n++;g[k]=m/n;k++;l=q}e=g}0==c?
(c=e.length,d=0,a(e)):(h=e,g=c+h.length,k=new Float32Array(g),k.set(b.subarray(d)),k.set(h,c),d=0,c=g,a(k))}}}(F.getContext())})();e.addDynamicChannel(p)}e.addDynamicChannel(function(){var a=new e.DynamicChannel;a.name="TSMF";var b={type:"image/jpeg"},d=Array(1);a.process=function(c){c.getPosition();var e=c.getLittleEndian32()&1073741823;var f=c.getLittleEndian32();var g=c.getLittleEndian32();switch(e){case 2:if(256==g){c.getLittleEndian32();g=new Uint8Array(16);var h=new RdpBuffer(g,0,16);h.setLittleEndian32(2);
h.setLittleEndian32(f);h.setLittleEndian32(1);h.setLittleEndian32(0);a.send(g)}break;case 0:switch(g){case 257:c.getBytes(16);c.getLittleEndian32();break;case 256:e=c.getPosition();h=c.getLittleEndian32();for(g=0;g<h;g++){c.getLittleEndian32();var k=c.getLittleEndian32();c.getLittleEndian32();c.skipPosition(k-4)}g=c.getPosition()-e;h=g+8+4;g=new Uint8Array(h);h=new RdpBuffer(g,0,h);h.setLittleEndian32(-2147483648);h.setLittleEndian32(f);g.set(c.getData().subarray(e,c.getPosition()),8);a.send(g);break;
case 261:c.getBytes(16);c.getLittleEndian32();break;case 264:e=c.getLittleEndian32();c.skipPosition(4);c.getLittleEndian32();k=c.getBytes(16);var l=c.getBytes(16);c.getLittleEndian32();c.getLittleEndian32();c.getLittleEndian32();var n=c.getBytes(16);g=c.getLittleEndian32();c.skipPosition(g);g=new Uint8Array(20);h=new RdpBuffer(g,0,20);h.setLittleEndian32(-2147483648);h.setLittleEndian32(f);hi5.Arrays.equals([118,105,100,115,0,0,16,0,128,0,0,170,0,56,155,113],k)&&hi5.Arrays.equals([77,74,80,71,0,0,
16,0,128,0,0,170,0,56,155,113],l)&&hi5.Arrays.equals([128,159,88,5,86,195,206,17,191,1,0,170,0,85,89,90],n)?h.setLittleEndian32(1):(h.setLittleEndian32(0),svGlobal.logger.warn("Format is not supported:"),svGlobal.logger.warn(k),svGlobal.logger.warn(l),svGlobal.logger.warn(n));h.setLittleEndian32(e);a.send(g);break;case 258:c.getBytes(16);c.getLittleEndian32();e=c.getLittleEndian32();c.skipPosition(e);break;case 263:c.getBytes(16),g=new Uint8Array(16),h=new RdpBuffer(g,0,16),h.setLittleEndian32(-2147483648),
h.setLittleEndian32(f),h.setLittleEndian32(1),a.send(g);case 277:c.getBytes(16);c.getLittleEndian32();break;case 262:c.getBytes(16);y.flushImgs();y.setImgRect(0,0,0,0);g=new Uint8Array(12);h=new RdpBuffer(g,0,12);h.setLittleEndian32(-2147483648);h.setLittleEndian32(f);a.send(g);break;case 278:c.getBytes(16);f=c.getLittleEndian32();g=c.getLittleEndian32();e=c.getLittleEndian32();c=c.getLittleEndian32();y.setImgRect(f,g,e-f,c-g);break;case 265:c.getBytes(16);c.getLittleEndian64();c.getLittleEndian32();
break;case 266:c.getBytes(16);break;case 268:c.getBytes(16);break;case 267:c.getBytes(16);break;case 269:c.getBytes(16);c.getLittleEndian32();break;case 274:break;case 275:break;case 259:c.getBytes(16);c.getLittleEndian32();c.getLittleEndian32();c.skipPosition(32);g=c.getLittleEndian32();f=new Image;e=c.getPosition();d[0]=c.getData().subarray(e,e+g);c=new Blob(d,b);f.src=URL.createObjectURL(c);y.addImg(f);break;case 270:y.flushImgs();break;case 273:break;case 260:break;case 276:c.getBytes(16);g=c.getLittleEndian32();
e=c.getPosition()+g;c.skipPosition(8);f=c.getLittleEndian32();svGlobal.logger.info("window state:"+f);h=c.getLittleEndian32();k=c.getLittleEndian32();f=c.getLittleEndian32();g=c.getLittleEndian32();c.skipPosition(8);l=c.getLittleEndian32();n=c.getLittleEndian32();svGlobal.logger.info("Window rect, left:"+f+" top:"+g+" w:"+h+" h:"+k+" cl:"+l+" ct:"+n);c.setPosition(e);e=c.getLittleEndian32();for(e=c.getPosition()+e;c.getPosition()<e;){l=c.getLittleEndian32();n=c.getLittleEndian32();var p=c.getLittleEndian32(),
r=c.getLittleEndian32();svGlobal.logger.info("visible region, l:"+n+" t:"+l+" r:"+r+" b:"+p)}y.setImgRect(f,g,h,k);break;case 1:case 2:break;default:svGlobal.logger.warn("unknown function:"+g)}break;default:svGlobal.logger.warn("unkown interface:"+e)}};return a}());ka||e.addDynamicChannel(f());t.enableDVCAudio&&e.addDynamicChannel(function(a){var b=!1,c=0,f=0,g=0,k=0,l=[],n=new Uint8Array(4),p=new e.DynamicChannel;p.name="AUDIO_PLAYBACK_DVC";p.onclose=function(){};p.process=function(e){function h(b){b.skipPosition(14);
var c=b.getLittleEndian16();b.getByte();var e=b.getLittleEndian16();b.skipPosition(1);for(var f,g=l.length=0;g<c;g++){var h=new d;h.fromBuffer(b);(f=22050<=h.nSamplesPerSec&&(1==h.formatTag||49==h.formatTag&&22050==h.nSamplesPerSec&&0==a))&&l.push(h)}h=20;b=l.length;for(g=0;g<b;g++)h+=l[g].getSize();g=h+4;c=new RdpBuffer(new Uint8Array(g),0,g);c.setByte(7);c.setByte(2);c.setLittleEndian16(h);c.setLittleEndian32(3);c.setLittleEndian32(4294967295);c.setLittleEndian32(0);c.setLittleEndian16(0);c.setLittleEndian16(b);
c.skipPosition(1);c.setLittleEndian16(e);c.setByte(124);for(g=0;g<b;g++)h=l[g],h.toBuffer(c);c.markEnd();p.send(c);5<e&&(c=new RdpBuffer(new Uint8Array(8),0,8),c.setByte(12),c.skipPosition(1),c.setLittleEndian16(4),c.setLittleEndian16(0),c.setLittleEndian16(0),c.markEnd(),p.send(c))}function q(a){var b=a.getLittleEndian16();a=a.getLittleEndian16();var c=new RdpBuffer(new Uint8Array(8),0,8);c.setByte(6);c.setByte(35);c.setLittleEndian16(4);c.setLittleEndian16(b);c.setLittleEndian16(a);c.markEnd();
p.send(c)}function r(){var a=l[g];if(a.formatTag!=S||a.nSamplesPerSec!=ea||W!=a.nChannels)S=a.formatTag,W=a.nChannels,ea=a.nSamplesPerSec,ja=49==a.formatTag?8:a.bitsPerSample}function t(a){f=a.getLittleEndian16();g=a.getLittleEndian16();k=a.getByte();a.skipPosition(3);n[0]=a.getByte();n[1]=a.getByte();n[2]=a.getByte();n[3]=a.getByte();b=!0;r()}function u(a,b){var c=new RdpBuffer(new Uint8Array(8),0,8);c.setByte(5);c.skipPosition(1);c.setLittleEndian16(4);c.setLittleEndian16(a);c.setByte(b);c.skipPosition(1);
c.markEnd();p.send(c)}function w(a){b=!1;var d=c-8,e=Date.now();a.copyFromByteArray(n,0,a.getPosition(),4);a=Va(a,k,f,d);a=1E3*(a-F.delay);e=f+(Date.now()-e)+a;u(e,k)}function x(a){var b=Date.now();f=a.getLittleEndian16();g=a.getLittleEndian16();k=a.getByte();a.skipPosition(7);r();a=Va(a,k,f,0);a=1E3*(a-F.delay);b=f+(Date.now()-b)+a;u(b,k)}if(b)w(e);else{var y=e.getByte();e.skipPosition(1);c=e.getLittleEndian16();switch(y){case 7:h(e);break;case 6:q(e);break;case 2:t(e);break;case 1:closed=!0;break;
case 3:e.getLittleEndian16();e.getLittleEndian16();break;case 13:x(e)}}};return p}(g))}}};this.resetStatus=Ma;this.exeAppCmd=function(a){var b=w.getFocused();b&&b.exeCommand(a)};this.activateApp=function(a){var b;(b=hi5.tool.isNumber(a)?w.getWinById(a):w.getMainWinByAppId(a))?b.activate(1):svGlobal.logger.warn("No window found in "+a)};this.reconnect=function(a,b,c){void 0==c&&(c=t.forceReconnect||!1);if(!L&&!c)return!1;l.minWidth&&a<l.minWidth&&(a=l.minWidth);l.minHeight&&b<l.minHeight&&(b=l.minHeight);
a&=-4;b&=-4;if(!c&&4>Math.abs(a-I)&&4>Math.abs(b-G))return!1;if(N&&N.enabled)N.applyResolution(a,b);else if(Wa&&ma||c||V&&!Wa)ma=!1,svGlobal.logger.info("reconnecting..."),A("8E0"+a+"\t"+b),T&&(T.remoteLockFlags=0,T.checkLockFlags=!0);return!0};this.notify=function(a,b){a="8E6"+a;b&&(a+="\t"+b.join(";"));A(a)};this.getUploadManager=function(){return O};this.addSurface=function(a){if(!w.hasSurface(a)&&(Ba||y.setContext(a.context),!w.hasSurface(a)||!a.railWin)){ka&&a.setPlayerMode();l.mouseMoveEmu&&
(a.mouseMoveEmu=X(l.mouseMoveEmu));a.setSize(50,50,"hidden");var b=a.getFreeSpace();0==I&&(I=b.width);0==G&&(G=b.height);a.setConfig(t);w.addSurface(a);la(I,G,!1,l.monitorDef?!0:!1);a.setController(T);a.setTouchpad(X(l.touchpad));var c=b=X(l.mapClipboard),e=b;void 0!=l.copyToLocal?c=X(l.copyToLocal):void 0!=t.copyToLocal&&(c=t.copyToLocal);void 0!=l.copyToRemote?e=X(l.copyToRemote):void 0!=t.copyToRemote&&(e=t.copyToRemote);a.setClipboard(b,c,e);Ua&&db(a);l.invitation&&(w.setReadOnly(!0),b=hi5.$("requestControl"))&&
(b.disabled=!1);a.run(parseInt(l.keyboard||1033,10))}};this.getRunninApps=this.getRunningApps=function(){for(var a=[],b=0,c=w.size();b<c;b++)w.getSurface(b).railWin.getMain(w.zOrders)&&a.push(w.getSurface(b).railWin.getMain(w.zOrders).titleInfo);return a};this.startApp=function(a,b,c){b=b||"";c=c||"";A("8C2"+a+"\t"+b+"\t"+c);var e=w.getSurface(w.size()-1);e&&(e.remoteApp=new eb(a,b,c))};this.startExitingApp=function(a){a=w.popWins(a);for(var b=a.length-1;0<=b;b--)w.addWin(a[b])};this.VirtualChannel=
function(){return new Na(143)};this.GatewayChannel=function(){return new Na(28)};this.DynamicChannel=function(){return new Na(64)};this.addChannel=function(a){ha[a.name]=a};this.addGatewayChannel=function(a){ia[a.name]=a};this.addDynamicChannel=function(a){H.names.push(a.name);H[a.name]=a;H.count++};if(X(l.smartCard)){var ya=new e.GatewayChannel,Za=null;ya.name="SCARDSTB";ya.onopen=function(){Za=document.getElementById(hi5.appcfg.clientAppletId||"clientApplet")};ya.process=function(a){var b=null;
if(Za){var c=a.getPosition();a=hi5.Base64.enc(a.getData(),a.getEnd()-c,c);try{a=Za.deviceControl(a),b=hi5.Base64.dec(a,0)}catch(g){svGlobal.logger.warn(g)}}b||(b=[0]);a=new hi5.DataBuffer(b);a.markEnd(b.length);ya.send(a)};e.addGatewayChannel(ya)}var Qa={type:6,data:null};this.run=function(){gb();F.supportWebAudio&&F.iOSFix()};this.getDesktop=function(){return y};this.mouseDown=function(a,b,c){V&&A("80"+a+"\t"+b+"\t"+c)};this.mouseMove=function(a,b){V&&A("82"+a+"\t"+b)};this.mouseUp=function(a,b,
c){V&&A("81"+a+"\t"+b+"\t"+c)};this.writeKeyCode=function(a,b){V&&A("8B"+(a?0:49152)+"\t"+b)};this.writeScancode=function(a,b){V&&("number"==typeof a?(A("840\t"+a),A("8449152\t"+a)):A("84"+(a?0:49152)+"\t"+b))};var Q=new RdpBuffer([],0,0);this.suppressOutput=function(a){if(!e.sessionInfo.suppressOutput)return!1;void 0==a&&(a=!0);var b=new Uint8Array(a?3:11);b[0]=146;b[1]=3;b[2]=a?1:0;a||(b[3]=Ga,b[4]=Ga>>8,b[5]=Fa,b[6]=Fa>>8,b[7]=Ha,b[8]=Ha>>8,b[9]=Ia,b[10]=Ia>>8);A(b.buffer);return!0};this.refreshOutput=
function(a,b,c,e){var d=new Uint8Array(c?11:3);d[0]=146;d[1]=3;d[2]=2;c&&(d[3]=a,d[4]=a>>8,d[5]=b,d[6]=b>>8,d[7]=c,d[8]=c>>8,d[9]=e,d[10]=e>>8);A(d.buffer)};this.sendPing=function(a){var b=new Uint8Array(a?2+a.length:2);b[0]=146;b[1]=0;a&&b.set(a,2);A(b.buffer)};this.startPing=function(a,b){b=b||0;P||(P=new hi5.tool.ResponseMonitor(function(){V&&e.sendPing()},function(){if(V&&e.onnoresponse)return e.onnoresponse()}));P.setInterval(a,b);var c=new Uint8Array(4);c[0]=146;c[1]=2;c[2]=a;c[3]=b;A(c.buffer);
setTimeout(function(){P.check()},1E3*(a+b));K?K.postMessage({type:0,cmd:6,start:1}):(D.onSlowPath=D.onFastPath=ob,D.onReqHistory=function(){ob(15555)})};this.stopPing=function(){P&&P.stop();K?K.postMessage({type:0,cmd:6,start:0}):D.onSlowPath=D.onFastPath=D.onReqHistory=null};var Y=null,vb=0;this.play=function(){A("F3")};this.pause=function(){A("F2")};this.scan=function(a){A("F4"+(a?"1":"0"))};this.seek=function(a){var b=w.getFocused();b&&L&&(A("F4"+(a?"1":"0")+"\t"+(a/b.getScale().x|0)),y.pause(!0))};
var ja=W=S=0;var ea=22050;var ub=!1;this.showMessage=function(a,b,c){e&&e.displayMsg&&a&&((b=b||w.getFocused())?b.showMessage(a,c):hi5.notifications.notify({msg:a,timeout:c||0}))};this._unload=ta;this.close=function(){svGlobal.logger.info("closing...");y&&y.isSendingHistory()?(svGlobal.logger.warn("In the middle of sending history, close delayed"),setTimeout(xb,2222)):xb()};hi5.browser.isChromeApp?chrome.runtime.onSuspend.addListener(e.close):window.addEventListener("unload",e.close,!1)}
Rdp.languageToKeyboard={af:0,sq:0,ar:1025,"ar-SA":1025,"ar-IQ":0,"ar-EG":0,"ar-LY":0,"ar-DZ":0,"ar-MA":0,"ar-TN":0,"ar-OM":0,"ar-YE":0,"ar-SY":0,"ar-JO":0,"ar-LB":0,"ar-KW":0,"ar-AE":0,"ar-BH":0,"ar-QA":0,eu:0,bg:0,be:0,ca:0,zh:2052,"zh-TW":1028,"zh-CN":2052,"zh-HK":1028,"zh-SG":2052,hr:0,cs:0,da:0,nl:1043,"nl-BE":2067,en:1033,"en-US":1033,"en-GB":2057,"en-AU":0,"en-CA":4105,"en-NA":0,"en-IE":0,"en-ZA":0,"en-JM":0,"en-BZ":0,et:0,fo:0,fa:0,fi:0,fr:1036,"fr-BE":2060,"fr-CA":3084,"fr-CH":4108,"fr-LU":0,
gd:0,"gd-IE":0,de:1031,"de-CH":2055,"de-AT":0,"de-LU":0,"de-LI":0,el:0,he:1037,hi:0,hu:0,is:1039,id:0,it:1040,"it-CH":66576,ja:3758162961,ko:3758162962,lv:0,lt:0,mk:0,mt:0,nb:1044,nn:1083,no:1044,pl:1045,pt:2070,"pt-BR":1046,rm:0,ro:0,"ro-MO":0,ru:1049,"ru-MO":0,sr:0,sk:0,sl:0,sb:0,es:1034,"es-AR":0,"es-GT":0,"es-CR":0,"es-PA":0,"es-DO":0,"es-MX":2058,"es-VE":0,"es-CO":0,"es-PE":0,"es-EC":0,"es-CL":0,"es-UY":0,"es-PY":0,"es-BO":0,"es-SV":0,"es-HN":0,"es-NI":0,"es-PR":0,sx:0,sv:1053,"sv-FI":0,th:0,
ts:0,tn:0,tr:1055,uk:0,ur:0,ve:0,vi:0,xh:0,ji:0,zu:0,detect:function(){var p=navigator&&(navigator.language||navigator.userLanguage),C=Rdp.languageToKeyboard[p];if(!C){var J=p.indexOf("-");J&&(C=Rdp.languageToKeyboard[p.substring(0,J)])}C||(console.log("No valid layout for "+p),C=1033);return C}};svGlobal.Rdp||(svGlobal.Rdp=Rdp);var RdpBuffer=hi5.DataBuffer;
